<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸš€ PORTAL GACOR KELAS 8I - SMPN 7 Kotabumi Selatan</title>
    
    <!-- FONT AWESOME PRO -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- GOOGLE FONTS SUPER ELEGAN -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800;900&family=Poppins:wght@300;400;500;600;700&family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@700;800;900&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- CHART.JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- SWIPER JS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    
    <!-- PUSHER FOR REAL-TIME CHAT -->
    <script src="https://js.pusher.com/7.2/pusher.min.js"></script>
    
    <style>
    /* ========== VARIABEL SUPER MEWAH ========== */
    :root {
        /* Color Palette Premium */
        --primary: #6366f1;
        --primary-dark: #4f46e5;
        --primary-light: #818cf8;
        --accent: #f472b6;
        --accent-dark: #db2777;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --info: #06b6d4;
        --gold: #FFD700;
        --neon: #00ff9d;
        
        /* Gradient Premium */
        --gradient-primary: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
        --gradient-accent: linear-gradient(135deg, #f472b6 0%, #db2777 100%);
        --gradient-dark: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        --gradient-gold: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        --gradient-neon: linear-gradient(135deg, #00ff9d 0%, #00b8ff 100%);
        --gradient-rainbow: linear-gradient(90deg, #ff0080, #ff8c00, #40e0d0, #8a2be2);
        
        /* Background Colors */
        --bg-dark: #0a0a1a;
        --bg-darker: #050510;
        --bg-card: rgba(20, 25, 45, 0.8);
        --bg-glass: rgba(255, 255, 255, 0.05);
        --bg-light: #f8fafc;
        --bg-white: #ffffff;
        
        /* Text Colors */
        --text-light: #ffffff;
        --text-dark: #0f172a;
        --text-gray: #94a3b8;
        --text-neon: #00ff9d;
        
        /* Shadows & Effects */
        --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
        --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
        --shadow-md: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        --shadow-lg: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
        --shadow-xl: 0 25px 50px -12px rgba(0,0,0,0.25);
        --shadow-glow: 0 0 30px rgba(99, 102, 241, 0.5);
        --shadow-neon: 0 0 20px rgba(0, 255, 157, 0.5);
        
        /* Border Radius */
        --radius-sm: 8px;
        --radius: 12px;
        --radius-md: 16px;
        --radius-lg: 20px;
        --radius-xl: 24px;
        --radius-full: 9999px;
        
        /* Transitions */
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-bounce: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    /* ========== RESET & BASE ========== */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    html {
        scroll-behavior: smooth;
        scroll-padding-top: 100px;
    }
    
    body {
        font-family: 'Inter', 'Poppins', sans-serif;
        background: var(--bg-dark);
        color: var(--text-light);
        min-height: 100vh;
        overflow-x: hidden;
        line-height: 1.6;
        background-image: 
            radial-gradient(circle at 10% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 25%),
            radial-gradient(circle at 90% 80%, rgba(219, 39, 119, 0.15) 0%, transparent 25%),
            radial-gradient(circle at 50% 50%, rgba(0, 255, 157, 0.1) 0%, transparent 30%),
            linear-gradient(45deg, rgba(10, 10, 26, 0.9), rgba(5, 5, 16, 0.95));
    }
    
    /* ========== TYPOGRAPHY MEWAH ========== */
    h1, h2, h3, h4, h5, h6 {
        font-family: 'Montserrat', sans-serif;
        font-weight: 900;
        line-height: 1.2;
        letter-spacing: -0.5px;
    }
    
    h1 { 
        font-size: clamp(2.8rem, 6vw, 4.5rem); 
        background: var(--gradient-rainbow);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    h2 { 
        font-size: clamp(2.2rem, 5vw, 3.5rem); 
    }
    
    h3 { 
        font-size: clamp(1.8rem, 4vw, 2.5rem); 
    }
    
    h4 { 
        font-size: clamp(1.4rem, 3vw, 2rem); 
    }
    
    .text-gradient {
        background: var(--gradient-neon);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 900;
    }
    
    .text-glow {
        text-shadow: 0 0 10px currentColor;
    }
    
    /* ========== CONTAINER & LAYOUT ========== */
    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 2rem;
    }
    
    .section {
        padding: 6rem 0;
        position: relative;
    }
    
    .section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, var(--primary), transparent);
    }
    
    /* ========== NAVBAR SUPER MEWAH ========== */
    .navbar {
        background: rgba(10, 10, 26, 0.95);
        backdrop-filter: blur(25px) saturate(180%);
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 1000;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding: 1.2rem 0;
        transition: var(--transition);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    
    .navbar.scrolled {
        padding: 0.8rem 0;
        background: rgba(10, 10, 26, 0.98);
        box-shadow: var(--shadow-xl);
    }
    
    .navbar .container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 3rem;
    }
    
    .logo {
        display: flex;
        align-items: center;
        gap: 1.2rem;
    }
    
    .logo-icon {
        width: 60px;
        height: 60px;
        background: var(--gradient-rainbow);
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'Montserrat', sans-serif;
        font-weight: 900;
        font-size: 2rem;
        color: white;
        box-shadow: var(--shadow-glow), 0 0 30px rgba(255, 0, 128, 0.3);
        animation: pulse 2s infinite;
        position: relative;
        overflow: hidden;
    }
    
    .logo-icon::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
        transform: rotate(45deg);
        animation: shine 3s infinite;
    }
    
    .nav-links {
        display: flex;
        align-items: center;
        gap: 0.8rem;
    }
    
    .nav-link {
        color: var(--text-light);
        text-decoration: none;
        padding: 0.85rem 1.5rem;
        border-radius: var(--radius-full);
        transition: var(--transition);
        font-weight: 600;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        gap: 0.6rem;
        position: relative;
        background: var(--bg-glass);
        border: 1px solid transparent;
    }
    
    .nav-link:hover {
        background: rgba(99, 102, 241, 0.15);
        border-color: var(--primary);
        transform: translateY(-2px);
        box-shadow: var(--shadow-glow);
    }
    
    .nav-link.active {
        background: rgba(99, 102, 241, 0.25);
        border-color: var(--primary);
        box-shadow: var(--shadow-glow);
    }
    
    .nav-link.active::after {
        content: '';
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 40px;
        height: 3px;
        background: var(--gradient-primary);
        border-radius: var(--radius-full);
        animation: pulse 2s infinite;
    }
    
    /* ========== BUTTONS MEWAH ========== */
    .btn {
        padding: 1rem 2rem;
        border-radius: var(--radius-lg);
        border: none;
        font-family: 'Inter', sans-serif;
        font-weight: 700;
        font-size: 1rem;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        text-decoration: none;
        position: relative;
        overflow: hidden;
        z-index: 1;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        transition: var(--transition-slow);
        z-index: -1;
    }
    
    .btn:hover::before {
        left: 100%;
    }
    
    .btn-primary {
        background: var(--gradient-primary);
        color: white;
        box-shadow: var(--shadow), 0 5px 20px rgba(99, 102, 241, 0.4);
    }
    
    .btn-primary:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: var(--shadow-xl), 0 10px 30px rgba(99, 102, 241, 0.6);
    }
    
    .btn-neon {
        background: var(--gradient-neon);
        color: var(--bg-dark);
        font-weight: 900;
        box-shadow: var(--shadow-neon);
    }
    
    .btn-neon:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 0 30px rgba(0, 255, 157, 0.7);
    }
    
    .btn-gold {
        background: var(--gradient-gold);
        color: var(--bg-dark);
        font-weight: 900;
        box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
    }
    
    .btn-gold:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 10px 30px rgba(255, 215, 0, 0.6);
    }
    
    .btn-outline {
        background: transparent;
        border: 2px solid var(--primary);
        color: var(--primary);
    }
    
    .btn-outline:hover {
        background: var(--primary);
        color: white;
        transform: translateY(-2px);
        box-shadow: var(--shadow-glow);
    }
    
    .btn-sm {
        padding: 0.6rem 1.2rem;
        font-size: 0.9rem;
    }
    
    .btn-lg {
        padding: 1.2rem 2.5rem;
        font-size: 1.1rem;
    }
    
    /* ========== CARDS SUPER MEWAH ========== */
    .card {
        background: var(--bg-card);
        backdrop-filter: blur(20px) saturate(180%);
        border-radius: var(--radius-xl);
        border: 1px solid rgba(255, 255, 255, 0.1);
        overflow: hidden;
        transition: var(--transition);
        position: relative;
        box-shadow: var(--shadow-xl);
    }
    
    .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: var(--gradient-primary);
        opacity: 0.7;
        transition: var(--transition);
    }
    
    .card:hover {
        transform: translateY(-10px) scale(1.02);
        border-color: var(--primary);
        box-shadow: var(--shadow-xl), 0 20px 40px rgba(0, 0, 0, 0.3);
    }
    
    .card:hover::before {
        opacity: 1;
    }
    
    .card-header {
        padding: 1.8rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        background: linear-gradient(to right, rgba(99, 102, 241, 0.1), transparent);
    }
    
    .card-body {
        padding: 2rem;
    }
    
    .card-footer {
        padding: 1.8rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(0, 0, 0, 0.2);
    }
    
    .card-glass {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* ========== STATS CARD MEWAH ========== */
    .stat-card {
        text-align: center;
        padding: 2.5rem;
        position: relative;
        overflow: hidden;
    }
    
    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--gradient-primary);
        opacity: 0.05;
        z-index: 0;
    }
    
    .stat-number {
        font-size: 3.5rem;
        font-weight: 900;
        background: var(--gradient-rainbow);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        line-height: 1;
        margin-bottom: 0.75rem;
        position: relative;
        z-index: 1;
        text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .stat-label {
        font-size: 0.95rem;
        color: var(--text-gray);
        text-transform: uppercase;
        letter-spacing: 2px;
        font-weight: 600;
        position: relative;
        z-index: 1;
    }
    
    /* ========== GRID SYSTEM ========== */
    .grid {
        display: grid;
        gap: 2rem;
    }
    
    .grid-2 {
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    }
    
    .grid-3 {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }
    
    .grid-4 {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }
    
    .grid-5 {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
    
    /* ========== FORMS MEWAH ========== */
    .form-group {
        margin-bottom: 2rem;
        position: relative;
    }
    
    .form-label {
        display: block;
        margin-bottom: 0.75rem;
        color: var(--text-light);
        font-weight: 600;
        font-size: 1rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .form-control {
        width: 100%;
        padding: 1rem 1.5rem;
        border-radius: var(--radius-lg);
        background: rgba(255, 255, 255, 0.05);
        border: 2px solid rgba(255, 255, 255, 0.1);
        color: var(--text-light);
        font-family: 'Inter', sans-serif;
        transition: var(--transition);
        font-size: 1rem;
        backdrop-filter: blur(10px);
    }
    
    .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.3);
        background: rgba(255, 255, 255, 0.08);
        transform: translateY(-2px);
    }
    
    .form-control::placeholder {
        color: rgba(255, 255, 255, 0.4);
    }
    
    /* ========== TABLES MEWAH ========== */
    .table-responsive {
        overflow-x: auto;
        border-radius: var(--radius-lg);
        margin: 2rem 0;
        background: rgba(0, 0, 0, 0.2);
        padding: 1px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .table {
        width: 100%;
        border-collapse: collapse;
        background: var(--bg-card);
        min-width: 800px;
    }
    
    .table th {
        background: linear-gradient(to right, rgba(99, 102, 241, 0.2), rgba(244, 114, 182, 0.2));
        padding: 1.5rem;
        text-align: left;
        font-weight: 700;
        color: var(--text-light);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-bottom: 3px solid var(--primary);
    }
    
    .table td {
        padding: 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 1rem;
        font-weight: 500;
    }
    
    .table tr {
        transition: var(--transition);
    }
    
    .table tr:hover {
        background: rgba(99, 102, 241, 0.15);
        transform: translateX(5px);
    }
    
    /* ========== BADGES MEWAH ========== */
    .badge {
        display: inline-flex;
        align-items: center;
        padding: 0.4rem 1rem;
        border-radius: var(--radius-full);
        font-size: 0.8rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        gap: 0.5rem;
        box-shadow: var(--shadow);
    }
    
    .badge-primary {
        background: rgba(99, 102, 241, 0.2);
        color: var(--primary);
        border: 1px solid rgba(99, 102, 241, 0.4);
    }
    
    .badge-success {
        background: rgba(16, 185, 129, 0.2);
        color: var(--success);
        border: 1px solid rgba(16, 185, 129, 0.4);
    }
    
    .badge-warning {
        background: rgba(245, 158, 11, 0.2);
        color: var(--warning);
        border: 1px solid rgba(245, 158, 11, 0.4);
    }
    
    .badge-danger {
        background: rgba(239, 68, 68, 0.2);
        color: var(--danger);
        border: 1px solid rgba(239, 68, 68, 0.4);
    }
    
    .badge-neon {
        background: rgba(0, 255, 157, 0.2);
        color: var(--neon);
        border: 1px solid rgba(0, 255, 157, 0.4);
        box-shadow: var(--shadow-neon);
    }
    
    .badge-gold {
        background: rgba(255, 215, 0, 0.2);
        color: var(--gold);
        border: 1px solid rgba(255, 215, 0, 0.4);
    }
    
    /* ========== GALERI SUPER MEWAH ========== */
    .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 2rem;
        margin: 3rem 0;
    }
    
    .gallery-item {
        position: relative;
        border-radius: var(--radius-xl);
        overflow: hidden;
        aspect-ratio: 1;
        background: var(--bg-card);
        border: 2px solid transparent;
        transition: var(--transition);
        cursor: pointer;
        box-shadow: var(--shadow-xl);
    }
    
    .gallery-item:hover {
        transform: translateY(-10px) scale(1.05);
        border-color: var(--primary);
        box-shadow: var(--shadow-xl), 0 30px 60px rgba(0, 0, 0, 0.4);
    }
    
    .gallery-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: var(--transition-slow);
    }
    
    .gallery-item:hover .gallery-img {
        transform: scale(1.15);
    }
    
    .gallery-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(transparent, rgba(0,0,0,0.95));
        padding: 2rem;
        color: white;
        transform: translateY(100%);
        transition: var(--transition-slow);
    }
    
    .gallery-item:hover .gallery-overlay {
        transform: translateY(0);
    }
    
    /* ========== SWIPER CAROUSEL ========== */
    .swiper {
        width: 100%;
        height: 400px;
        border-radius: var(--radius-xl);
        overflow: hidden;
        margin: 3rem 0;
    }
    
    .swiper-slide {
        background-position: center;
        background-size: cover;
        position: relative;
    }
    
    .swiper-slide::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(99,102,241,0.3), rgba(244,114,182,0.3));
        opacity: 0;
        transition: var(--transition);
    }
    
    .swiper-slide-active::after {
        opacity: 1;
    }
    
    /* ========== MODALS MEWAH ========== */
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(20px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        padding: 2rem;
        animation: fadeIn 0.4s ease;
    }
    
    .modal.active {
        display: flex;
    }
    
    .modal-content {
        background: var(--bg-card);
        border-radius: var(--radius-xl);
        max-width: 600px;
        width: 100%;
        overflow: hidden;
        border: 2px solid rgba(255, 255, 255, 0.1);
        box-shadow: var(--shadow-xl), 0 0 50px rgba(99, 102, 241, 0.3);
        transform: translateY(30px) scale(0.95);
        animation: modalAppear 0.4s ease forwards;
    }
    
    /* ========== TOAST NOTIFICATION MEWAH ========== */
    .toast {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        background: var(--bg-card);
        border-left: 5px solid var(--primary);
        border-radius: var(--radius-lg);
        padding: 1.5rem 2rem;
        box-shadow: var(--shadow-xl), 0 10px 30px rgba(0,0,0,0.3);
        display: none;
        align-items: center;
        gap: 1.5rem;
        z-index: 3000;
        max-width: 500px;
        transform: translateX(100%) translateY(20px);
        animation: toastSlideIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        backdrop-filter: blur(20px);
    }
    
    .toast.active {
        display: flex;
    }
    
    /* ========== REALTIME NOTIFICATION ========== */
    .realtime-notification {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        max-width: 400px;
        animation: slideInRight 0.5s ease, fadeOut 5s ease 5s forwards;
    }
    
    .realtime-sync {
        position: fixed;
        bottom: 10px;
        left: 10px;
        background: var(--success);
        color: white;
        padding: 8px 15px;
        border-radius: var(--radius);
        font-size: 12px;
        z-index: 1000;
        display: none;
        align-items: center;
        gap: 8px;
        box-shadow: var(--shadow);
    }
    
    .realtime-sync.active {
        display: flex;
        animation: fadeInUp 0.3s ease;
    }
    
    .notification-badge {
        animation: pulse 1s infinite;
        position: absolute;
        top: -5px;
        right: -5px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--danger);
        color: white;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* ========== ADMIN CONTROLS ========== */
    .admin-only {
        display: none;
    }
    
    .admin-only.show {
        display: block;
    }
    
    .admin-controls {
        display: none;
        gap: 1rem;
        flex-wrap: wrap;
    }
    
    .admin-controls.show {
        display: flex;
    }
    
    /* ========== LOADING SCREEN MEWAH ========== */
    .loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--bg-dark);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        flex-direction: column;
        gap: 2rem;
        backdrop-filter: blur(20px);
    }
    
    .loader-content {
        text-align: center;
        max-width: 500px;
        padding: 2rem;
    }
    
    .spinner {
        width: 80px;
        height: 80px;
        border: 4px solid rgba(99, 102, 241, 0.1);
        border-top-color: var(--primary);
        border-right-color: var(--accent);
        border-bottom-color: var(--neon);
        border-radius: 50%;
        animation: spin 1.5s linear infinite;
        position: relative;
    }
    
    .spinner::after {
        content: '';
        position: absolute;
        top: -10px;
        left: -10px;
        right: -10px;
        bottom: -10px;
        border-radius: 50%;
        border: 2px solid transparent;
        border-top-color: var(--primary);
        animation: spin 2s linear infinite reverse;
    }
    
    /* ========== ACHIEVEMENT BADGES ========== */
    .achievement-badge {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        background: var(--gradient-gold);
        color: var(--bg-dark);
        box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
        position: relative;
        animation: float 3s ease-in-out infinite;
    }
    
    .achievement-badge::after {
        content: '';
        position: absolute;
        top: -5px;
        left: -5px;
        right: -5px;
        bottom: -5px;
        border-radius: 50%;
        border: 2px solid var(--gold);
        animation: pulse 2s infinite;
    }
    
    /* ========== COUNTDOWN TIMER ========== */
    .countdown {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin: 2rem 0;
    }
    
    .countdown-item {
        background: rgba(255, 255, 255, 0.05);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        text-align: center;
        min-width: 80px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .countdown-number {
        font-size: 2.5rem;
        font-weight: 900;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        line-height: 1;
    }
    
    .countdown-label {
        font-size: 0.8rem;
        color: var(--text-gray);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-top: 0.5rem;
    }
    
    /* ========== PROGRESS BARS ========== */
    .progress-bar {
        height: 12px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-full);
        overflow: hidden;
        position: relative;
    }
    
    .progress-fill {
        height: 100%;
        background: var(--gradient-primary);
        border-radius: var(--radius-full);
        position: relative;
        transition: width 1s ease;
    }
    
    .progress-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        animation: shine 2s infinite;
    }
    
    /* ========== LIVE STREAM STYLES ========== */
    .live-stream-container {
        position: relative;
        width: 100%;
        height: 500px;
        border-radius: var(--radius-xl);
        overflow: hidden;
        background: var(--bg-dark);
    }
    
    .live-indicator {
        position: absolute;
        top: 20px;
        left: 20px;
        background: var(--danger);
        color: white;
        padding: 8px 20px;
        border-radius: var(--radius-full);
        font-weight: 700;
        z-index: 10;
        display: flex;
        align-items: center;
        gap: 8px;
        animation: pulse 1.5s infinite;
    }
    
    .live-viewers {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 8px 15px;
        border-radius: var(--radius-full);
        font-weight: 600;
        z-index: 10;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .camera-preview {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .camera-controls {
        position: absolute;
        bottom: 20px;
        left: 0;
        right: 0;
        display: flex;
        justify-content: center;
        gap: 15px;
        z-index: 10;
    }
    
    /* ========== LIVE CHAT STYLES ========== */
    .live-chat-container {
        height: 500px;
        display: flex;
        flex-direction: column;
        background: var(--bg-card);
        border-radius: var(--radius-xl);
        overflow: hidden;
    }
    
    .chat-header {
        padding: 1rem 1.5rem;
        background: rgba(99, 102, 241, 0.2);
        border-bottom: 1px solid rgba(255,255,255,0.1);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .chat-message {
        display: flex;
        gap: 10px;
        max-width: 80%;
    }
    
    .chat-message.own {
        align-self: flex-end;
        flex-direction: row-reverse;
    }
    
    .message-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--gradient-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        flex-shrink: 0;
    }
    
    .message-content {
        background: rgba(255,255,255,0.1);
        padding: 12px 15px;
        border-radius: var(--radius-lg);
        max-width: calc(100% - 50px);
    }
    
    .chat-message.own .message-content {
        background: rgba(99, 102, 241, 0.3);
    }
    
    .message-sender {
        font-weight: 700;
        font-size: 0.9rem;
        margin-bottom: 4px;
    }
    
    .message-text {
        font-size: 0.95rem;
    }
    
    .chat-input-container {
        padding: 1rem 1.5rem;
        border-top: 1px solid rgba(255,255,255,0.1);
        background: rgba(0,0,0,0.3);
        display: flex;
        gap: 10px;
    }
    
    /* ========== VOTING STYLES ========== */
    .voting-container {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }
    
    .vote-option {
        background: rgba(255,255,255,0.05);
        border: 2px solid rgba(255,255,255,0.1);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        cursor: pointer;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }
    
    .vote-option:hover {
        background: rgba(99, 102, 241, 0.1);
        border-color: var(--primary);
        transform: translateY(-5px);
    }
    
    .vote-option.selected {
        background: rgba(99, 102, 241, 0.2);
        border-color: var(--primary);
        box-shadow: var(--shadow-glow);
    }
    
    .vote-percentage-bar {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 4px;
        background: var(--gradient-primary);
        transition: width 1s ease;
    }
    
    .vote-results {
        display: none;
    }
    
    .vote-results.show {
        display: block;
    }
    
    /* ========== PLAYLIST STYLES ========== */
    .playlist-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .playlist-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: rgba(255,255,255,0.05);
        border-radius: var(--radius-lg);
        transition: var(--transition);
        cursor: pointer;
    }
    
    .playlist-item:hover {
        background: rgba(99, 102, 241, 0.1);
        transform: translateX(5px);
    }
    
    .playlist-item.active {
        background: rgba(99, 102, 241, 0.2);
        border-left: 4px solid var(--primary);
    }
    
    .playlist-thumbnail {
        width: 60px;
        height: 60px;
        border-radius: var(--radius);
        object-fit: cover;
        background: var(--gradient-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
    }
    
    .audio-player {
        width: 100%;
        height: 60px;
        background: rgba(255,255,255,0.05);
        border-radius: var(--radius-xl);
        padding: 0 1.5rem;
        display: flex;
        align-items: center;
        gap: 1.5rem;
    }
    
    /* ========== UTILITY CLASSES ========== */
    .text-center { text-align: center; }
    .text-right { text-align: right; }
    .text-left { text-align: left; }
    
    .mt-1 { margin-top: 0.75rem; }
    .mt-2 { margin-top: 1.5rem; }
    .mt-3 { margin-top: 2rem; }
    .mt-4 { margin-top: 3rem; }
    .mt-5 { margin-top: 4rem; }
    
    .mb-1 { margin-bottom: 0.75rem; }
    .mb-2 { margin-bottom: 1.5rem; }
    .mb-3 { margin-bottom: 2rem; }
    .mb-4 { margin-bottom: 3rem; }
    .mb-5 { margin-bottom: 4rem; }
    
    .p-1 { padding: 0.75rem; }
    .p-2 { padding: 1.5rem; }
    .p-3 { padding: 2rem; }
    .p-4 { padding: 3rem; }
    .p-5 { padding: 4rem; }
    
    .w-100 { width: 100%; }
    .w-50 { width: 50%; }
    .w-auto { width: auto; }
    
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .items-center { align-items: center; }
    .justify-center { justify-content: center; }
    .justify-between { justify-content: space-between; }
    .justify-around { justify-content: space-around; }
    .gap-1 { gap: 0.75rem; }
    .gap-2 { gap: 1.5rem; }
    .gap-3 { gap: 2rem; }
    .gap-4 { gap: 3rem; }
    .gap-5 { gap: 4rem; }
    
    .hidden { display: none; }
    .block { display: block; }
    .inline-block { display: inline-block; }
    
    .rounded { border-radius: var(--radius); }
    .rounded-lg { border-radius: var(--radius-lg); }
    .rounded-xl { border-radius: var(--radius-xl); }
    .rounded-full { border-radius: var(--radius-full); }
    
    .shadow-glow { box-shadow: var(--shadow-glow); }
    .shadow-neon { box-shadow: var(--shadow-neon); }
    
    /* ========== ANIMATIONS ========== */
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(50px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes slideInRight {
        from {
            transform: translateX(100px);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    
    @keyframes float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-20px); }
    }
    
    @keyframes shine {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }
    
    @keyframes modalAppear {
        to {
            transform: translateY(0) scale(1);
        }
    }
    
    @keyframes toastSlideIn {
        to {
            transform: translateX(0) translateY(0);
        }
    }
    
    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; transform: translateX(100px); }
    }
    
    .animate-fadeIn {
        animation: fadeIn 0.6s ease;
    }
    
    .animate-fadeInUp {
        animation: fadeInUp 0.8s ease;
    }
    
    .animate-slideInRight {
        animation: slideInRight 0.6s ease;
    }
    
    .animate-pulse {
        animation: pulse 2s infinite;
    }
    
    .animate-float {
        animation: float 3s ease-in-out infinite;
    }
    
    .animate-delay-1 { animation-delay: 0.1s; }
    .animate-delay-2 { animation-delay: 0.2s; }
    .animate-delay-3 { animation-delay: 0.3s; }
    .animate-delay-4 { animation-delay: 0.4s; }
    .animate-delay-5 { animation-delay: 0.5s; }
    
    /* ========== RESPONSIVE DESIGN ========== */
    @media (max-width: 1200px) {
        .container {
            padding: 0 1.5rem;
        }
        
        .section {
            padding: 5rem 0;
        }
        
        .grid-4, .grid-5 {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    @media (max-width: 768px) {
        .navbar .container {
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .nav-links {
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }
        
        .nav-link {
            padding: 0.7rem 1rem;
            font-size: 0.85rem;
        }
        
        .grid-2, .grid-3, .grid-4, .grid-5 {
            grid-template-columns: 1fr;
        }
        
        .gallery-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .section {
            padding: 4rem 0;
        }
        
        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1rem;
        }
        
        .stat-number {
            font-size: 2.8rem;
        }
        
        .table th, .table td {
            padding: 1rem;
            font-size: 0.9rem;
        }
    }
    
    @media (max-width: 480px) {
        .container {
            padding: 0 1rem;
        }
        
        .gallery-grid {
            grid-template-columns: 1fr;
        }
        
        .stat-number {
            font-size: 2.2rem;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
        }
        
        .btn {
            padding: 0.8rem 1.5rem;
            font-size: 0.9rem;
        }
    }
    
    /* ========== DARK MODE (default) ========== */
    body.light-mode {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        color: var(--text-dark);
    }
    
    body.light-mode .card {
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid rgba(0, 0, 0, 0.1);
        color: var(--text-dark);
        box-shadow: var(--shadow-xl);
    }
    
    body.light-mode .navbar {
        background: rgba(255, 255, 255, 0.98);
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    body.light-mode .nav-link {
        color: var(--text-dark);
        background: rgba(0, 0, 0, 0.05);
    }
    
    body.light-mode .form-control {
        background: rgba(255, 255, 255, 0.9);
        border: 2px solid rgba(0, 0, 0, 0.2);
        color: var(--text-dark);
    }
    
    body.light-mode .table {
        background: rgba(255, 255, 255, 0.95);
    }
    
    body.light-mode .table th {
        background: linear-gradient(to right, rgba(99, 102, 241, 0.1), rgba(244, 114, 182, 0.1));
        color: var(--text-dark);
    }
    
    body.light-mode .table td {
        border-color: rgba(0, 0, 0, 0.1);
        color: var(--text-dark);
    }
    
    body.light-mode .modal-content {
        background: rgba(255, 255, 255, 0.98);
        color: var(--text-dark);
    }
    
    body.light-mode .toast {
        background: rgba(255, 255, 255, 0.95);
        color: var(--text-dark);
    }
    
    /* ========== SCROLLBAR CUSTOM ========== */
    ::-webkit-scrollbar {
        width: 12px;
        height: 12px;
    }
    
    ::-webkit-scrollbar-track {
        background: rgba(30, 41, 59, 0.5);
        border-radius: var(--radius);
    }
    
    ::-webkit-scrollbar-thumb {
        background: var(--gradient-primary);
        border-radius: var(--radius);
        border: 2px solid var(--bg-dark);
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: var(--primary);
    }
    
    /* ========== CUSTOM SELECTION ========== */
    ::selection {
        background: var(--primary);
        color: white;
        text-shadow: none;
    }
    
    /* ========== FLOATING ELEMENTS ========== */
    .floating {
        animation: float 6s ease-in-out infinite;
    }
    
    .floating-slow {
        animation: float 8s ease-in-out infinite;
    }
    
    .floating-fast {
        animation: float 4s ease-in-out infinite;
    }
    </style>
</head>
<body>
    <!-- ========== LOADING SCREEN MEWAH ========== -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
        <div class="loader-content">
            <h2 class="text-gradient mb-2">PORTAL KELAS 8I</h2>
            <p style="font-size: 1.1rem; opacity: 0.9;">Loading experience premium...</p>
            <div class="progress-bar mt-4" style="width: 300px; margin: 0 auto;">
                <div class="progress-fill" style="width: 0%" id="loadingProgress"></div>
            </div>
        </div>
    </div>

    <!-- ========== NAVBAR SUPER MEWAH ========== -->
    <nav class="navbar" id="navbar">
        <div class="container">
            <div class="logo">
                <div class="logo-icon">8I</div>
                <div>
                    <h3 class="text-gradient">KELAS 8I ELITE</h3>
                    <p style="font-size: 0.9rem; opacity: 0.9; letter-spacing: 1px;">SMP Negeri 7 Kotabumi Selatan</p>
                </div>
            </div>
            
            <div class="nav-links">
                <a href="#home" class="nav-link active">
                    <i class="fas fa-home"></i> Home
                </a>
                <a href="#students" class="nav-link">
                    <i class="fas fa-users"></i> Siswa
                </a>
                <a href="#livestream" class="nav-link">
                    <i class="fas fa-broadcast-tower"></i> Live Stream
                </a>
                <a href="#voting" class="nav-link">
                    <i class="fas fa-vote-yea"></i> Voting
                </a>
                <a href="#playlist" class="nav-link">
                    <i class="fas fa-music"></i> Playlist
                </a>
                <a href="#gallery" class="nav-link">
                    <i class="fas fa-images"></i> Galeri
                </a>
                <a href="#livechat" class="nav-link">
                    <i class="fas fa-comments"></i> Live Chat
                </a>
                <a href="#ranking" class="nav-link">
                    <i class="fas fa-trophy"></i> Ranking
                </a>
                
                <div id="userSection">
                    <button id="loginBtn" class="btn btn-neon btn-sm">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </div>
                
                <button class="btn btn-outline btn-sm" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- ========== HERO SECTION MEWAH ========== -->
    <section id="home" class="section" style="padding-top: 10rem;">
        <div class="container">
            <div class="text-center animate-fadeInUp">
                <h1 class="mb-4">ðŸš€ PORTAL GACOR KELAS 8I</h1>
                <p class="mb-5" style="font-size: 1.3rem; max-width: 900px; margin: 0 auto; opacity: 0.95; line-height: 1.8;">
                    <span class="text-gradient">Platform Digital Premium</span> dengan fitur lengkap untuk 
                    <span class="text-gradient">Siswa, Guru, dan Orang Tua</span>. Dilengkapi teknologi terkini untuk pembelajaran maksimal!
                </p>
                
                <div class="flex gap-4 justify-center mb-8 flex-wrap">
                    <a href="#students" class="btn btn-primary btn-lg">
                        <i class="fas fa-users"></i> Data Siswa
                    </a>
                    <a href="#livestream" class="btn btn-danger btn-lg">
                        <i class="fas fa-broadcast-tower"></i> Live Stream
                    </a>
                    <a href="#livechat" class="btn btn-success btn-lg">
                        <i class="fas fa-comments"></i> Live Chat
                    </a>
                    <a href="#voting" class="btn btn-warning btn-lg">
                        <i class="fas fa-vote-yea"></i> Voting
                    </a>
                </div>
                
                <!-- COUNTDOWN UJIAN -->
                <div class="card card-glass mt-6">
                    <div class="card-body text-center">
                        <h4 class="mb-4"><i class="fas fa-clock"></i> Countdown Ujian Semester</h4>
                        <div class="countdown" id="examCountdown">
                            <div class="countdown-item">
                                <div class="countdown-number" id="days">00</div>
                                <div class="countdown-label">Hari</div>
                            </div>
                            <div class="countdown-item">
                                <div class="countdown-number" id="hours">00</div>
                                <div class="countdown-label">Jam</div>
                            </div>
                            <div class="countdown-item">
                                <div class="countdown-number" id="minutes">00</div>
                                <div class="countdown-label">Menit</div>
                            </div>
                            <div class="countdown-item">
                                <div class="countdown-number" id="seconds">00</div>
                                <div class="countdown-label">Detik</div>
                            </div>
                        </div>
                        <p class="mt-4" style="opacity: 0.8;">Ujian Semester Genap 2024</p>
                    </div>
                </div>
            </div>
            
            <!-- STATISTIK MEWAH -->
            <div class="grid grid-4 mt-8">
                <div class="card stat-card animate-fadeInUp animate-delay-1">
                    <div class="stat-number" id="totalStudents">34</div>
                    <div class="stat-label">Total Siswa</div>
                    <div class="mt-3">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                <div class="card stat-card animate-fadeInUp animate-delay-2">
                    <div class="stat-number" id="averageGrade">8.7</div>
                    <div class="stat-label">Rata-rata Nilai</div>
                    <div class="mt-3">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 87%"></div>
                        </div>
                    </div>
                </div>
                <div class="card stat-card animate-fadeInUp animate-delay-3">
                    <div class="stat-number" id="attendanceRate">97%</div>
                    <div class="stat-label">Kehadiran</div>
                    <div class="mt-3">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 97%"></div>
                        </div>
                    </div>
                </div>
                <div class="card stat-card animate-fadeInUp">
                    <div class="stat-number" id="onlineUsers">12</div>
                    <div class="stat-label">Online Users</div>
                    <div class="mt-3">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 35%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== DATA SISWA MEWAH ========== -->
    <section id="students" class="section" style="background: linear-gradient(135deg, rgba(15, 23, 42, 0.4), rgba(30, 41, 59, 0.4));">
        <div class="container">
            <div class="card">
                <div class="card-header flex items-center justify-between">
                    <div>
                        <h4><i class="fas fa-users-crown"></i> Data Siswa Kelas 8I Elite</h4>
                        <p style="opacity: 0.9; font-size: 0.95rem;">Tahun Ajaran 2023/2024 - Semester Genap</p>
                    </div>
                    <div class="admin-controls" id="studentControls">
                        <button class="btn btn-success btn-sm" onclick="addStudentWithRealtimeDialog()">
                            <i class="fas fa-user-plus"></i> Tambah Siswa
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="importStudents()">
                            <i class="fas fa-file-import"></i> Import Excel
                        </button>
                        <button class="btn btn-gold btn-sm" onclick="generateRanking()">
                            <i class="fas fa-trophy"></i> Generate Ranking
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="clearAllGradesWithRealtime()">
                            <i class="fas fa-trash"></i> Reset Data
                        </button>
                        <button class="btn btn-neon btn-sm" onclick="broadcastToAllUsers('Update Data', 'Admin sedang memperbarui data siswa')">
                            <i class="fas fa-bullhorn"></i> Broadcast
                        </button>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex gap-3">
                            <button class="btn btn-outline btn-sm active" data-filter="all">Semua</button>
                            <button class="btn btn-outline btn-sm" data-filter="laki">Laki-laki</button>
                            <button class="btn btn-outline btn-sm" data-filter="perempuan">Perempuan</button>
                            <button class="btn btn-outline btn-sm" data-filter="top10">Top 10</button>
                        </div>
                        <div class="flex gap-2" style="width: 300px;">
                            <input type="text" class="form-control" id="searchStudent" placeholder="Cari siswa...">
                            <button class="btn btn-primary" onclick="searchStudents()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Nama Lengkap</th>
                                    <th>NIS</th>
                                    <th>Nilai Rata-rata</th>
                                    <th>Kehadiran</th>
                                    <th>Status</th>
                                    <th>Prestasi</th>
                                    <th class="admin-only">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="studentsTableBody">
                                <!-- Data akan diisi JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card-footer flex items-center justify-between">
                    <div>Total: <span id="studentCount">34</span> siswa | <span id="maleCount">18</span> Laki-laki | <span id="femaleCount">16</span> Perempuan</div>
                    <div class="flex gap-3">
                        <button class="btn btn-outline btn-sm" onclick="exportToExcel()">
                            <i class="fas fa-file-excel"></i> Export Excel
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="printTable()">
                            <i class="fas fa-print"></i> Print
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="showCharts()">
                            <i class="fas fa-chart-bar"></i> Grafik
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== LIVE STREAM SECTION ========== -->
    <section id="livestream" class="section">
        <div class="container">
            <div class="card">
                <div class="card-header flex items-center justify-between">
                    <div>
                        <h4><i class="fas fa-broadcast-tower"></i> Live Streaming Camera</h4>
                        <p style="opacity: 0.9; font-size: 0.95rem;">Streaming langsung dari kelas dengan kamera premium</p>
                    </div>
                    <div class="admin-controls" id="streamControls">
                        <button class="btn btn-danger btn-sm" onclick="startLiveStream()">
                            <i class="fas fa-broadcast-tower"></i> Start Stream
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="stopLiveStream()">
                            <i class="fas fa-stop"></i> Stop Stream
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="changeCamera()">
                            <i class="fas fa-camera"></i> Switch Camera
                        </button>
                        <button class="btn btn-success btn-sm" onclick="recordStream()">
                            <i class="fas fa-record-vinyl"></i> Record
                        </button>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="live-stream-container">
                        <div class="live-indicator" id="liveIndicator">
                            <i class="fas fa-circle"></i> LIVE
                        </div>
                        <div class="live-viewers" id="viewerCount">
                            <i class="fas fa-eye"></i> <span id="viewers">0</span> viewers
                        </div>
                        <video id="cameraPreview" class="camera-preview" autoplay playsinline></video>
                        <div class="camera-controls">
                            <button class="btn btn-danger" onclick="toggleCamera()" id="cameraToggle">
                                <i class="fas fa-camera"></i> Start Camera
                            </button>
                            <button class="btn btn-outline" onclick="toggleMicrophone()" id="micToggle">
                                <i class="fas fa-microphone"></i> Mic On
                            </button>
                            <button class="btn btn-outline" onclick="toggleScreenShare()">
                                <i class="fas fa-desktop"></i> Share Screen
                            </button>
                            <button class="btn btn-primary" onclick="takeSnapshot()">
                                <i class="fas fa-camera-retro"></i> Snapshot
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-3 gap-4 mt-6">
                        <div class="card card-glass">
                            <div class="card-body">
                                <h5><i class="fas fa-signal"></i> Stream Stats</h5>
                                <div class="mt-3">
                                    <div>Bitrate: <span id="bitrate">0</span> kbps</div>
                                    <div>Resolution: <span id="resolution">0x0</span></div>
                                    <div>FPS: <span id="fps">0</span></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card card-glass">
                            <div class="card-body">
                                <h5><i class="fas fa-users"></i> Viewers</h5>
                                <div id="viewerList" class="mt-3">
                                    <!-- Daftar viewer -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="card card-glass">
                            <div class="card-body">
                                <h5><i class="fas fa-cog"></i> Settings</h5>
                                <div class="mt-3">
                                    <div class="form-group">
                                        <label class="form-label">Quality</label>
                                        <select class="form-control" id="qualitySelect">
                                            <option value="360p">360p (Low)</option>
                                            <option value="480p">480p (Medium)</option>
                                            <option value="720p" selected>720p (HD)</option>
                                            <option value="1080p">1080p (Full HD)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== VOTING SECTION ========== -->
    <section id="voting" class="section" style="background: linear-gradient(135deg, rgba(15, 23, 42, 0.4), rgba(30, 41, 59, 0.4));">
        <div class="container">
            <div class="card">
                <div class="card-header flex items-center justify-between">
                    <div>
                        <h4><i class="fas fa-vote-yea"></i> Real-Time Voting System</h4>
                        <p style="opacity: 0.9; font-size: 0.95rem;">Pemungutan suara real-time untuk berbagai keperluan kelas</p>
                    </div>
                    <div class="admin-controls" id="votingControls">
                        <button class="btn btn-primary btn-sm" onclick="createNewVote()">
                            <i class="fas fa-plus"></i> Buat Voting
                        </button>
                        <button class="btn btn-success btn-sm" onclick="resetVotingWithRealtime()">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteVotingWithRealtime()">
                            <i class="fas fa-trash"></i> Hapus
                        </button>
                        <button class="btn btn-neon btn-sm" onclick="showResults()">
                            <i class="fas fa-chart-bar"></i> Hasil
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="broadcastToAllUsers('Voting Update', 'Admin sedang mengelola voting')">
                            <i class="fas fa-bullhorn"></i> Broadcast
                        </button>
                    </div>
                </div>
                
                <div class="card-body">
                    <!-- ACTIVE VOTING -->
                    <div id="activeVoting">
                        <h5 class="mb-4"><i class="fas fa-vote-yea"></i> Voting Aktif</h5>
                        <div class="card card-glass mb-6">
                            <div class="card-body">
                                <h4 id="voteQuestion">Pilih Ketua Kelas Baru</h4>
                                <p class="mb-4" style="opacity: 0.8;">Pilih salah satu calon ketua kelas untuk periode mendatang</p>
                                
                                <div class="voting-container" id="voteOptions">
                                    <!-- Opsi voting akan diisi JavaScript -->
                                </div>
                                
                                <div class="flex justify-between items-center mt-6">
                                    <div>
                                        <span class="badge badge-primary">
                                            <i class="fas fa-users"></i> <span id="totalVotes">0</span> votes
                                        </span>
                                        <span class="badge badge-success ml-2">
                                            <i class="fas fa-clock"></i> Ends in: <span id="voteTime">23:59</span>
                                        </span>
                                    </div>
                                    <button class="btn btn-primary" onclick="submitVote()" id="submitVoteBtn">
                                        <i class="fas fa-paper-plane"></i> Submit Vote
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- VOTING RESULTS -->
                    <div class="vote-results" id="voteResults">
                        <h5 class="mb-4"><i class="fas fa-chart-bar"></i> Hasil Voting</h5>
                        <div class="card card-glass">
                            <div class="card-body">
                                <canvas id="voteChart" style="width: 100%; height: 300px;"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- VOTING HISTORY -->
                    <div class="mt-8">
                        <h5 class="mb-4"><i class="fas fa-history"></i> Voting History</h5>
                        <div class="grid grid-3 gap-4" id="votingHistory">
                            <!-- History voting akan diisi JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== PLAYLIST SECTION ========== -->
    <section id="playlist" class="section">
        <div class="container">
            <div class="card">
                <div class="card-header flex items-center justify-between">
                    <div>
                        <h4><i class="fas fa-music"></i> Class Playlist & Audio Library</h4>
                        <p style="opacity: 0.9; font-size: 0.95rem;">Koleksi musik dan audio untuk kegiatan belajar mengajar</p>
                    </div>
                    <div class="admin-controls" id="playlistControls">
                        <button class="btn btn-primary btn-sm" onclick="openAddPlaylistModal()">
                            <i class="fas fa-plus"></i> Tambah Audio
                        </button>
                        <button class="btn btn-success btn-sm" onclick="openAddPlaylistFromCatbox()">
                            <i class="fas fa-link"></i> Add from Catbox
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="clearPlaylistWithRealtime()">
                            <i class="fas fa-trash"></i> Clear All
                        </button>
                        <button class="btn btn-neon btn-sm" onclick="shufflePlaylist()">
                            <i class="fas fa-random"></i> Shuffle
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="broadcastToAllUsers('Playlist Update', 'Admin sedang mengupdate playlist')">
                            <i class="fas fa-bullhorn"></i> Broadcast
                        </button>
                    </div>
                </div>
                
                <div class="card-body">
                    <!-- AUDIO PLAYER -->
                    <div class="audio-player mb-6">
                        <button class="btn btn-outline" onclick="playPrevious()">
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button class="btn btn-primary" onclick="togglePlay()" id="playBtn">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="btn btn-outline" onclick="playNext()">
                            <i class="fas fa-step-forward"></i>
                        </button>
                        <div style="flex: 1; margin: 0 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span id="currentTrack">No track selected</span>
                                <span id="currentTime">0:00 / 0:00</span>
                            </div>
                            <input type="range" id="progressBar" min="0" max="100" value="0" style="width: 100%;">
                        </div>
                        <input type="range" id="volumeControl" min="0" max="100" value="50" style="width: 100px;">
                        <span id="volumeIcon" style="cursor: pointer;" onclick="toggleMute()">
                            <i class="fas fa-volume-up"></i>
                        </span>
                    </div>
                    
                    <!-- PLAYLIST -->
                    <h5 class="mb-4"><i class="fas fa-list"></i> Playlist</h5>
                    <div class="playlist-container" id="playlistContainer">
                        <!-- Daftar playlist akan diisi JavaScript -->
                    </div>
                    
                    <!-- RECENTLY ADDED -->
                    <div class="mt-8">
                        <h5 class="mb-4"><i class="fas fa-history"></i> Recently Added</h5>
                        <div class="grid grid-4 gap-4" id="recentTracks">
                            <!-- Recent tracks akan diisi JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== GALERI KELAS MEWAH ========== -->
    <section id="gallery" class="section" style="background: linear-gradient(135deg, rgba(15, 23, 42, 0.4), rgba(30, 41, 59, 0.4));">
        <div class="container">
            <div class="card">
                <div class="card-header flex items-center justify-between">
                    <h4><i class="fas fa-images"></i> Galeri Kelas 8I Elite</h4>
                    <div class="admin-controls" id="galleryControls">
                        <button class="btn btn-primary btn-sm" onclick="openGalleryModal()">
                            <i class="fas fa-plus"></i> Tambah Foto
                        </button>
                        <button class="btn btn-success btn-sm" onclick="openVideoModal()">
                            <i class="fas fa-video"></i> Tambah Video
                        </button>
                        <button class="btn btn-info btn-sm" onclick="openCatboxModal()">
                            <i class="fas fa-link"></i> Add from Catbox
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteAllGalleryWithRealtime()">
                            <i class="fas fa-trash"></i> Hapus Semua
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="broadcastToAllUsers('Gallery Update', 'Admin sedang mengupdate galeri')">
                            <i class="fas fa-bullhorn"></i> Broadcast
                        </button>
                    </div>
                </div>
                
                <div class="card-body">
                    <!-- FILTER GALERI -->
                    <div class="flex gap-3 mb-6">
                        <button class="btn btn-outline active" data-gallery-filter="all">Semua</button>
                        <button class="btn btn-outline" data-gallery-filter="foto">Foto</button>
                        <button class="btn btn-outline" data-gallery-filter="video">Video</button>
                        <button class="btn btn-outline" data-gallery-filter="kegiatan">Kegiatan</button>
                        <button class="btn btn-outline" data-gallery-filter="prestasi">Prestasi</button>
                    </div>
                    
                    <div class="gallery-grid" id="galleryGrid">
                        <!-- Galeri akan diisi JavaScript -->
                    </div>
                </div>
                
                <div class="card-footer text-center">
                    <button class="btn btn-outline" onclick="loadMoreGallery()">
                        <i class="fas fa-spinner"></i> Load More...
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== LIVE CHAT SECTION ========== -->
    <section id="livechat" class="section">
        <div class="container">
            <div class="card">
                <div class="card-header flex items-center justify-between">
                    <div>
                        <h4><i class="fas fa-comments"></i> Real-Time Live Chat</h4>
                        <p style="opacity: 0.9; font-size: 0.95rem;">Chat langsung dengan semua anggota kelas secara real-time</p>
                    </div>
                    <div class="flex gap-2">
                        <span class="badge badge-success" id="onlineCount">
                            <i class="fas fa-users"></i> <span id="onlineUsersCount">0</span> online
                        </span>
                        <button class="btn btn-sm btn-outline" onclick="clearChat()">
                            <i class="fas fa-trash"></i> Clear Chat
                        </button>
                        <button class="btn btn-sm btn-warning" onclick="broadcastToAllUsers('Chat Update', 'Admin sedang mengelola chat')">
                            <i class="fas fa-bullhorn"></i> Broadcast
                        </button>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="grid grid-2 gap-6">
                        <!-- CHAT MESSAGES -->
                        <div class="live-chat-container">
                            <div class="chat-header">
                                <h5 style="margin: 0;">Kelas 8I Chat Room</h5>
                                <span class="badge badge-primary" id="messageCount">0 messages</span>
                            </div>
                            
                            <div class="chat-messages" id="chatMessages">
                                <!-- Pesan chat akan diisi JavaScript -->
                            </div>
                            
                            <div class="chat-input-container">
                                <input type="text" class="form-control" id="chatInput" placeholder="Type your message..." onkeypress="handleChatKeyPress(event)">
                                <button class="btn btn-primary" onclick="sendChatMessage()">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                                <button class="btn btn-outline" onclick="toggleEmojiPicker()">
                                    <i class="far fa-smile"></i>
                                </button>
                                <button class="btn btn-outline" onclick="attachFile()">
                                    <i class="fas fa-paperclip"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- ONLINE USERS -->
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-users"></i> Online Users</h5>
                            </div>
                            <div class="card-body" id="onlineUsersList">
                                <!-- Daftar user online akan diisi JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- CHAT FEATURES -->
                    <div class="grid grid-4 gap-4 mt-6">
                        <div class="card card-glass text-center p-4">
                            <i class="fas fa-image text-3xl mb-3" style="color: var(--primary);"></i>
                            <h6>Image Sharing</h6>
                            <p style="font-size: 0.9rem; opacity: 0.8;">Share images in chat</p>
                        </div>
                        
                        <div class="card card-glass text-center p-4">
                            <i class="fas fa-file text-3xl mb-3" style="color: var(--success);"></i>
                            <h6>File Sharing</h6>
                            <p style="font-size: 0.9rem; opacity: 0.8;">Share documents & files</p>
                        </div>
                        
                        <div class="card card-glass text-center p-4">
                            <i class="fas fa-video text-3xl mb-3" style="color: var(--danger);"></i>
                            <h6>Voice Messages</h6>
                            <p style="font-size: 0.9rem; opacity: 0.8;">Send voice messages</p>
                        </div>
                        
                        <div class="card card-glass text-center p-4">
                            <i class="fas fa-lock text-3xl mb-3" style="color: var(--warning);"></i>
                            <h6>Secure Chat</h6>
                            <p style="font-size: 0.9rem; opacity: 0.8;">End-to-end encryption</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== RANKING & PRESTASI ========== -->
    <section id="ranking" class="section" style="background: linear-gradient(135deg, rgba(15, 23, 42, 0.4), rgba(30, 41, 59, 0.4));">
        <div class="container">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-trophy"></i> Ranking & Prestasi Kelas</h4>
                    <p style="opacity: 0.9; font-size: 0.95rem;">Top 10 Siswa Terbaik Semester Genap 2024</p>
                </div>
                
                <div class="card-body">
                    <div class="grid grid-2 gap-6">
                        <!-- RANKING LIST -->
                        <div>
                            <h5 class="mb-4"><i class="fas fa-crown"></i> Top 10 Ranking</h5>
                            <div id="rankingList">
                                <!-- Diisi JavaScript -->
                            </div>
                        </div>
                        
                        <!-- ACHIEVEMENT CHART -->
                        <div>
                            <h5 class="mb-4"><i class="fas fa-chart-line"></i> Grafik Prestasi</h5>
                            <div style="height: 300px;">
                                <canvas id="rankingChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- MONTHLY PROGRESS -->
                    <div class="mt-8">
                        <h5 class="mb-4"><i class="fas fa-chart-bar"></i> Progress Bulanan</h5>
                        <div class="grid grid-5">
                            <div class="text-center">
                                <div class="progress-bar" style="height: 150px; transform: rotate(180deg);">
                                    <div class="progress-fill" style="width: 100%; height: 85%"></div>
                                </div>
                                <p class="mt-3">Jan</p>
                            </div>
                            <div class="text-center">
                                <div class="progress-bar" style="height: 150px; transform: rotate(180deg);">
                                    <div class="progress-fill" style="width: 100%; height: 78%"></div>
                                </div>
                                <p class="mt-3">Feb</p>
                            </div>
                            <div class="text-center">
                                <div class="progress-bar" style="height: 150px; transform: rotate(180deg);">
                                    <div class="progress-fill" style="width: 100%; height: 92%"></div>
                                </div>
                                <p class="mt-3">Mar</p>
                            </div>
                            <div class="text-center">
                                <div class="progress-bar" style="height: 150px; transform: rotate(180deg);">
                                    <div class="progress-fill" style="width: 100%; height: 88%"></div>
                                </div>
                                <p class="mt-3">Apr</p>
                            </div>
                            <div class="text-center">
                                <div class="progress-bar" style="height: 150px; transform: rotate(180deg);">
                                    <div class="progress-fill" style="width: 100%; height: 95%"></div>
                                </div>
                                <p class="mt-3">Mei</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== FOOTER MEWAH ========== -->
    <footer class="section" style="background: linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(10, 10, 26, 0.9));">
        <div class="container">
            <div class="grid grid-4 gap-8 mb-8">
                <div>
                    <div class="logo-icon mb-4" style="width: 80px; height: 80px;">8I</div>
                    <h3 class="text-gradient mb-3">KELAS 8I ELITE</h3>
                    <p style="opacity: 0.9;">SMP Negeri 7 Kotabumi Selatan</p>
                    <p class="mt-3" style="opacity: 0.8; font-size: 0.95rem;">
                        Jl. Stadion Barat No. 45, Kelapa Tujuh, Kotabumi Selatan
                    </p>
                </div>
                
                <div>
                    <h4 class="mb-4">Menu Utama</h4>
                    <div class="flex flex-col gap-3">
                        <a href="#home" class="nav-link">Home</a>
                        <a href="#students" class="nav-link">Data Siswa</a>
                        <a href="#livestream" class="nav-link">Live Stream</a>
                        <a href="#livechat" class="nav-link">Live Chat</a>
                        <a href="#voting" class="nav-link">Voting</a>
                        <a href="#playlist" class="nav-link">Playlist</a>
                        <a href="#gallery" class="nav-link">Galeri</a>
                    </div>
                </div>
                
                <div>
                    <h4 class="mb-4">Fitur Admin</h4>
                    <div class="flex flex-col gap-3">
                        <button class="btn btn-outline text-left" onclick="openAdminPanel()">
                            <i class="fas fa-cog"></i> Control Panel
                        </button>
                        <button class="btn btn-outline text-left" onclick="exportData()">
                            <i class="fas fa-download"></i> Export All Data
                        </button>
                        <button class="btn btn-outline text-left" onclick="backupData()">
                            <i class="fas fa-database"></i> Backup to Cloud
                        </button>
                        <button class="btn btn-outline text-left" onclick="systemSettings()">
                            <i class="fas fa-sliders-h"></i> System Settings
                        </button>
                    </div>
                </div>
                
                <div>
                    <h4 class="mb-4">Kontak & Support</h4>
                    <div class="flex flex-col gap-3">
                        <p><i class="fas fa-user"></i> Perwakilan: Yama</p>
                        <p><i class="fas fa-envelope"></i> Email: yusufhisyamaa@gmail.com</p>
                        <p><i class="fas fa-phone"></i> WhatsApp: 088286708193</p>
                        <p><i class="fas fa-clock"></i> Support: 24/7 Online</p>
                        <div class="flex gap-3 mt-3">
                            <a href="#" class="btn btn-primary btn-sm">
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a href="#" class="btn btn-success btn-sm">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                            <a href="#" class="btn btn-info btn-sm">
                                <i class="fab fa-telegram"></i>
                            </a>
                            <a href="#" class="btn btn-danger btn-sm">
                                <i class="fab fa-youtube"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="border-top: 2px solid rgba(255, 255, 255, 0.1); padding-top: 3rem; text-align: center;">
                <p>&copy; 2024 Portal Kelas 8I Elite - SMP Negeri 7 Kotabumi Selatan. All rights reserved.</p>
                <p class="mt-3" style="opacity: 0.9; font-size: 1rem;">
                    Dibuat dengan <i class="fas fa-heart" style="color: var(--accent);"></i> oleh 
                    <span class="text-gradient">Tim IT Kelas 8I</span> | Versi 3.0 Premium
                </p>
                <div class="flex gap-4 justify-center mt-4">
                    <span class="badge badge-primary">HTML5</span>
                    <span class="badge badge-success">CSS3</span>
                    <span class="badge badge-warning">JavaScript</span>
                    <span class="badge badge-danger">WebRTC</span>
                    <span class="badge badge-neon">WebSocket</span>
                    <span class="badge badge-gold">Realtime Sync</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- ========== MODAL LOGIN MEWAH ========== -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="card-header flex items-center justify-between">
                <h3><i class="fas fa-lock"></i> Admin Login</h3>
                <button class="btn btn-sm" onclick="closeModal('loginModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="card-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <div class="relative">
                            <i class="fas fa-user absolute left-4 top-1/2 transform -translate-y-1/2" style="color: var(--primary);"></i>
                            <input type="text" class="form-control pl-12" id="username" placeholder="admin8i" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <div class="relative">
                            <i class="fas fa-key absolute left-4 top-1/2 transform -translate-y-1/2" style="color: var(--primary);"></i>
                            <input type="password" class="form-control pl-12" id="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                            <button type="button" class="absolute right-4 top-1/2 transform -translate-y-1/2" onclick="togglePassword()">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Role</label>
                        <select class="form-control" id="role">
                            <option value="admin">Admin</option>
                            <option value="guru">Guru</option>
                            <option value="wali_kelas">Wali Kelas</option>
                            <option value="orang_tua">Orang Tua</option>
                            <option value="siswa">Siswa</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Nama Lengkap</label>
                        <input type="text" class="form-control" id="fullName" placeholder="Nama Lengkap Anda">
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button type="button" class="btn btn-outline w-100" onclick="closeModal('loginModal')">
                            Batal
                        </button>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </button>
                    </div>
                    
                    <div class="text-center mt-4">
                        <p style="font-size: 0.9rem; opacity: 0.8;">Gunakan username dan password default untuk login sebagai admin</p>
                        <p style="font-size: 0.8rem; opacity: 0.6;">Admin: admin8i / password123</p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ========== MODAL ADD PLAYLIST FROM CATBOX ========== -->
    <div class="modal" id="catboxModal">
        <div class="modal-content">
            <div class="card-header flex items-center justify-between">
                <h3><i class="fas fa-link"></i> Add from Catbox URL</h3>
                <button class="btn btn-sm" onclick="closeModal('catboxModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="card-body">
                <form id="catboxForm">
                    <div class="form-group">
                        <label class="form-label">Catbox URL</label>
                        <input type="url" class="form-control" id="catboxUrl" placeholder="https://files.catbox.moe/abc123.mp3" required>
                        <p style="font-size: 0.9rem; opacity: 0.7; margin-top: 0.5rem;">
                            Masukkan URL dari catbox.moe untuk audio/mp3
                        </p>
                    </div>
                    
                    <div class="grid grid-2 gap-4">
                        <div class="form-group">
                            <label class="form-label">Judul Audio</label>
                            <input type="text" class="form-control" id="audioTitle" placeholder="Nama lagu atau audio" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Artis</label>
                            <input type="text" class="form-control" id="audioArtist" placeholder="Nama artis atau pembicara">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Kategori</label>
                        <select class="form-control" id="audioCategory">
                            <option value="music">Musik</option>
                            <option value="lecture">Ceramah/Kuliah</option>
                            <option value="podcast">Podcast</option>
                            <option value="sound_effect">Sound Effect</option>
                            <option value="other">Lainnya</option>
                        </select>
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button type="button" class="btn btn-outline w-100" onclick="closeModal('catboxModal')">
                            Batal
                        </button>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-plus"></i> Add to Playlist
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ========== MODAL ADD GALERI FROM CATBOX ========== -->
    <div class="modal" id="catboxGalleryModal">
        <div class="modal-content">
            <div class="card-header flex items-center justify-between">
                <h3><i class="fas fa-image"></i> Add Media from Catbox URL</h3>
                <button class="btn btn-sm" onclick="closeModal('catboxGalleryModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="card-body">
                <form id="catboxGalleryForm">
                    <div class="form-group">
                        <label class="form-label">Catbox URL</label>
                        <input type="url" class="form-control" id="catboxGalleryUrl" placeholder="https://files.catbox.moe/abc123.jpg" required>
                        <p style="font-size: 0.9rem; opacity: 0.7; margin-top: 0.5rem;">
                            Masukkan URL dari catbox.moe untuk gambar (jpg, png) atau video (mp4)
                        </p>
                    </div>
                    
                    <div class="grid grid-2 gap-4">
                        <div class="form-group">
                            <label class="form-label">Judul Media</label>
                            <input type="text" class="form-control" id="catboxMediaTitle" placeholder="Judul media" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Tipe Media</label>
                            <select class="form-control" id="catboxMediaType" onchange="toggleCatboxMediaType()">
                                <option value="image">Gambar</option>
                                <option value="video">Video</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Kategori</label>
                        <select class="form-control" id="catboxMediaCategory">
                            <option value="foto">Foto</option>
                            <option value="video">Video</option>
                            <option value="kegiatan">Kegiatan</option>
                            <option value="prestasi">Prestasi</option>
                            <option value="dokumentasi">Dokumentasi</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Deskripsi</label>
                        <textarea class="form-control" id="catboxMediaDesc" rows="3" placeholder="Deskripsi media..."></textarea>
                    </div>
                    
                    <div id="catboxPreview" class="text-center mt-4">
                        <p style="opacity: 0.7;">Preview akan muncul setelah URL dimasukkan</p>
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button type="button" class="btn btn-outline w-100" onclick="closeModal('catboxGalleryModal')">
                            Batal
                        </button>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-plus"></i> Add to Gallery
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ========== MODAL ADMIN PANEL ========== -->
    <div class="modal" id="adminPanelModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="card-header flex items-center justify-between">
                <h3><i class="fas fa-cogs"></i> Control Panel Admin</h3>
                <button class="btn btn-sm" onclick="closeModal('adminPanelModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="card-body">
                <div class="grid grid-3 gap-4">
                    <button class="btn btn-outline flex-col items-center p-4" onclick="backupData()">
                        <i class="fas fa-database text-3xl mb-2"></i>
                        <span>Backup Data</span>
                    </button>
                    
                    <button class="btn btn-outline flex-col items-center p-4" onclick="manageUsers()">
                        <i class="fas fa-users-cog text-3xl mb-2"></i>
                        <span>User Management</span>
                    </button>
                    
                    <button class="btn btn-outline flex-col items-center p-4" onclick="exportAllData()">
                        <i class="fas fa-download text-3xl mb-2"></i>
                        <span>Export All</span>
                    </button>
                    
                    <button class="btn btn-outline flex-col items-center p-4" onclick="systemLogs()">
                        <i class="fas fa-clipboard-list text-3xl mb-2"></i>
                        <span>System Logs</span>
                    </button>
                    
                    <button class="btn btn-outline flex-col items-center p-4" onclick="broadcastMessageDialog()">
                        <i class="fas fa-bullhorn text-3xl mb-2"></i>
                        <span>Broadcast</span>
                    </button>
                    
                    <button class="btn btn-outline flex-col items-center p-4" onclick="resetSystem()">
                        <i class="fas fa-redo text-3xl mb-2"></i>
                        <span>Reset System</span>
                    </button>
                </div>
                
                <div class="mt-6">
                    <h5 class="mb-3"><i class="fas fa-chart-pie"></i> System Analytics</h5>
                    <div class="grid grid-4 gap-4">
                        <div class="card card-glass text-center p-4">
                            <div class="text-2xl font-bold text-gradient" id="analyticsUsers">34</div>
                            <div class="text-sm opacity-80">Total Users</div>
                        </div>
                        <div class="card card-glass text-center p-4">
                            <div class="text-2xl font-bold text-gradient" id="analyticsChats">0</div>
                            <div class="text-sm opacity-80">Chat Messages</div>
                        </div>
                        <div class="card card-glass text-center p-4">
                            <div class="text-2xl font-bold text-gradient" id="analyticsVotes">0</div>
                            <div class="text-sm opacity-80">Total Votes</div>
                        </div>
                        <div class="card card-glass text-center p-4">
                            <div class="text-2xl font-bold text-gradient" id="analyticsOnline">0</div>
                            <div class="text-sm opacity-80">Online Now</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== TOAST NOTIFICATION MEWAH ========== -->
    <div class="toast" id="toast">
        <div id="toastIcon" style="font-size: 2rem;">
            <i class="fas fa-check-circle"></i>
        </div>
        <div style="flex: 1;">
            <h4 id="toastTitle" style="font-size: 1.1rem; margin-bottom: 0.25rem; font-weight: 700;">Sukses</h4>
            <p id="toastMessage" style="font-size: 0.95rem; opacity: 0.9;">Operasi berhasil</p>
        </div>
        <button class="btn btn-sm" onclick="closeToast()">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- ========== EMOJI PICKER (HIDDEN) ========== -->
    <div id="emojiPicker" style="display: none; position: fixed; bottom: 120px; right: 20px; background: var(--bg-card); border-radius: var(--radius-lg); padding: 1rem; z-index: 1000; max-width: 300px; box-shadow: var(--shadow-xl);">
        <div style="display: flex; flex-wrap: wrap; gap: 8px; max-height: 200px; overflow-y: auto;">
            <!-- Emoji akan diisi JavaScript -->
        </div>
    </div>

    <!-- ========== FLOATING ACTION BUTTON ========== -->
    <button class="btn btn-primary btn-lg floating" id="fab" style="position: fixed; bottom: 2rem; right: 2rem; z-index: 1000; width: 60px; height: 60px; border-radius: 50%; padding: 0; display: flex; align-items: center; justify-content: center;">
        <i class="fas fa-bolt"></i>
    </button>

    <!-- ========== HIDDEN VIDEO ELEMENT FOR SCREENSHARE ========== -->
    <video id="screenSharePreview" autoplay style="display: none;"></video>

    <!-- ========== REALTIME SYNC INDICATOR ========== -->
    <div class="realtime-sync" id="realtimeSyncIndicator">
        <i class="fas fa-sync-alt fa-spin"></i>
        <span>Syncing...</span>
    </div>

    <script>
    // ========== GLOBAL VARIABLES ==========
    let currentUser = null;
    let isAdmin = false;
    let userRole = '';
    let userId = null;
    let studentsData = [];
    let rankingData = [];
    let chatUsers = new Map();
    let activeVote = null;
    let userVotes = new Map();
    let playlist = [];
    let currentTrackIndex = -1;
    let audioPlayer = new Audio();
    let isPlaying = false;
    let stream = null;
    let peerConnections = new Map();
    let chatMessages = [];
    let galleryItems = [];
    let votingHistory = [];
    
    // ========== REALTIME SYSTEM VARIABLES ==========
    let pusher = null;
    let channels = {};
    let isRealtimeConnected = false;
    let lastUpdateTime = Date.now();
    
    // ========== REALTIME PUSHER CONFIGURATION ==========
    function initializeRealtimeSystem() {
        try {
            console.log('ðŸš€ Initializing realtime system...');
            
            // Initialize Pusher with public test key (replace with your own for production)
            pusher = new Pusher('2d8859410e51ac5448a5', {
                cluster: 'ap1',
                forceTLS: true
            });
            
            // Subscribe to public channel
            channels.main = pusher.subscribe('portal-kelas8i-public');
            
            // Listen for realtime events
            setupRealtimeListeners();
            
            isRealtimeConnected = true;
            console.log('âœ… Realtime system initialized');
            
            // Show connection status
            showRealtimeStatus('Connected to realtime server', 'success');
            
        } catch (error) {
            console.warn('âš ï¸ Pusher initialization failed:', error);
            console.log('ðŸ”„ Using fallback polling system');
            isRealtimeConnected = false;
            
            // Start polling as fallback
            startPollingSystem();
        }
    }
    
    function setupRealtimeListeners() {
        // Student data updates
        channels.main.bind('student-updated', function(data) {
            console.log('ðŸ“Š Realtime: Student data updated', data);
            updateStudentRealtime(data);
            showRealtimeSyncIndicator();
        });
        
        // Voting updates
        channels.main.bind('vote-updated', function(data) {
            console.log('ðŸ—³ï¸ Realtime: Voting updated', data);
            updateVotingRealtime(data);
            showRealtimeSyncIndicator();
        });
        
        // Chat messages
        channels.main.bind('chat-message', function(data) {
            console.log('ðŸ’¬ Realtime: New chat message', data);
            if (data.userId !== userId) { // Don't show own messages
                addRealtimeChatMessage(data);
            }
        });
        
        // Gallery updates
        channels.main.bind('gallery-updated', function(data) {
            console.log('ðŸ–¼ï¸ Realtime: Gallery updated', data);
            updateGalleryRealtime(data);
            showRealtimeSyncIndicator();
        });
        
        // Playlist updates
        channels.main.bind('playlist-updated', function(data) {
            console.log('ðŸŽµ Realtime: Playlist updated', data);
            updatePlaylistRealtime(data);
            showRealtimeSyncIndicator();
        });
        
        // User status updates
        channels.main.bind('user-status', function(data) {
            console.log('ðŸ‘¤ Realtime: User status updated', data);
            updateUserStatusRealtime(data);
        });
        
        // Admin broadcasts
        channels.main.bind('admin-broadcast', function(data) {
            console.log('ðŸ“¢ Realtime: Admin broadcast', data);
            showAdminBroadcast(data);
        });
        
        // System updates
        channels.main.bind('system-update', function(data) {
            console.log('âš™ï¸ Realtime: System update', data);
            showSystemUpdateNotification(data);
        });
        
        // Connection status
        channels.main.bind('pusher:subscription_succeeded', function() {
            console.log('âœ… Connected to realtime channel');
            showRealtimeStatus('Connected to realtime updates', 'success');
        });
        
        channels.main.bind('pusher:subscription_error', function(status) {
            console.error('âŒ Realtime connection error:', status);
            showRealtimeStatus('Realtime connection lost', 'error');
        });
    }
    
    // ========== POLLING SYSTEM (FALLBACK) ==========
    let pollingInterval;
    
    function startPollingSystem() {
        console.log('ðŸ”„ Starting polling system (fallback)');
        pollingInterval = setInterval(fetchUpdatesFromServer, 10000); // Poll every 10 seconds
    
        // Initial fetch
        fetchUpdatesFromServer();
    }
    
    function stopPollingSystem() {
        if (pollingInterval) {
            clearInterval(pollingInterval);
            console.log('ðŸ›‘ Polling system stopped');
        }
    }
    
    function fetchUpdatesFromServer() {
        // Simulate fetching updates from server
        console.log('ðŸ” Checking for updates...');
        
        // In a real app, this would fetch from your API
        // For demo, we'll simulate random updates
        if (Math.random() > 0.7) {
            simulateRandomUpdate();
        }
    }
    
    function simulateRandomUpdate() {
        const updates = [
            {
                type: 'student',
                action: 'update',
                student: {
                    id: Math.floor(Math.random() * 34) + 1,
                    averageGrade: (Math.random() * 2 + 8).toFixed(1),
                    attendance: Math.floor(Math.random() * 10 + 90)
                }
            },
            {
                type: 'vote',
                action: 'update',
                vote: activeVote
            },
            {
                type: 'chat',
                action: 'message',
                message: {
                    id: Date.now(),
                    userId: Math.floor(Math.random() * 5) + 1,
                    username: ['admin', 'guru', 'siswa1', 'ortu1'][Math.floor(Math.random() * 4)],
                    text: ['Halo semua!', 'Ada tugas baru nih', 'Jangan lupa belajar ya', 'Besok ada ujian'][Math.floor(Math.random() * 4)],
                    timestamp: new Date().toISOString()
                }
            }
        ];
        
        const update = updates[Math.floor(Math.random() * updates.length)];
        processUpdate(update);
    }
    
    function processUpdate(update) {
        switch(update.type) {
            case 'student':
                updateStudentRealtime(update);
                break;
            case 'vote':
                updateVotingRealtime(update);
                break;
            case 'chat':
                addRealtimeChatMessage(update.message);
                break;
        }
        
        showRealtimeSyncIndicator();
    }
    
    // ========== REALTIME UPDATE FUNCTIONS ==========
    
    // Update student data in realtime
    function updateStudentRealtime(data) {
        if (data.action === 'update') {
            const studentIndex = studentsData.findIndex(s => s.id === data.student.id);
            if (studentIndex !== -1) {
                // Update existing student
                studentsData[studentIndex] = { 
                    ...studentsData[studentIndex], 
                    ...data.student 
                };
                
                // Update UI
                renderStudents();
                
                // Show notification
                if (data.updatedBy && data.updatedBy !== currentUser) {
                    showRealtimeNotification(
                        'ðŸ“Š Data Siswa Diperbarui',
                        `${data.updatedBy} memperbarui data ${data.student.name || 'siswa'}`,
                        'info'
                    );
                }
            }
        } 
        else if (data.action === 'delete') {
            studentsData = studentsData.filter(s => s.id !== data.studentId);
            renderStudents();
            
            if (data.deletedBy && data.deletedBy !== currentUser) {
                showRealtimeNotification(
                    'ðŸ—‘ï¸ Siswa Dihapus',
                    `${data.deletedBy} menghapus data siswa`,
                    'warning'
                );
            }
        }
        else if (data.action === 'add') {
            studentsData.push(data.student);
            renderStudents();
            
            if (data.addedBy && data.addedBy !== currentUser) {
                showRealtimeNotification(
                    'âž• Siswa Baru',
                    `${data.addedBy} menambahkan siswa baru: ${data.student.name}`,
                    'success'
                );
            }
        }
    }
    
    // Update voting in realtime
    function updateVotingRealtime(data) {
        if (data.vote) {
            activeVote = data.vote;
            renderVoting();
            
            // Reset user vote if admin reset
            if (data.resetVotes) {
                userVotes.delete(userId);
            }
            
            if (data.updatedBy && data.updatedBy !== currentUser) {
                showRealtimeNotification(
                    'ðŸ—³ï¸ Voting Diperbarui',
                    `${data.updatedBy} memperbarui voting "${activeVote.question}"`,
                    'info'
                );
            }
        }
    }
    
    // Update gallery in realtime
    function updateGalleryRealtime(data) {
        if (data.action === 'add') {
            galleryItems.push(data.media);
            renderGallery();
            
            if (data.addedBy && data.addedBy !== currentUser) {
                showRealtimeNotification(
                    'ðŸ–¼ï¸ Media Baru',
                    `${data.addedBy} menambahkan media ke galeri`,
                    'success'
                );
            }
        }
        else if (data.action === 'delete') {
            galleryItems = galleryItems.filter(g => g.id !== data.mediaId);
            renderGallery();
            
            if (data.deletedBy && data.deletedBy !== currentUser) {
                showRealtimeNotification(
                    'ðŸ–¼ï¸ Media Dihapus',
                    `${data.deletedBy} menghapus media dari galeri`,
                    'warning'
                );
            }
        }
    }
    
    // Update playlist in realtime
    function updatePlaylistRealtime(data) {
        if (data.action === 'add') {
            playlist.push(data.track);
            renderPlaylist();
            renderRecentTracks();
            
            if (data.addedBy && data.addedBy !== currentUser) {
                showRealtimeNotification(
                    'ðŸŽµ Track Baru',
                    `${data.addedBy} menambahkan track ke playlist`,
                    'success'
                );
            }
        }
        else if (data.action === 'delete') {
            playlist = playlist.filter(p => p.id !== data.trackId);
            renderPlaylist();
            renderRecentTracks();
            
            if (data.deletedBy && data.deletedBy !== currentUser) {
                showRealtimeNotification(
                    'ðŸŽµ Track Dihapus',
                    `${data.deletedBy} menghapus track dari playlist`,
                    'warning'
                );
            }
        }
        else if (data.action === 'clear') {
            playlist = [];
            renderPlaylist();
            renderRecentTracks();
            
            if (data.clearedBy && data.clearedBy !== currentUser) {
                showRealtimeNotification(
                    'ðŸŽµ Playlist Dikosongkan',
                    `${data.clearedBy} mengosongkan playlist`,
                    'warning'
                );
            }
        }
    }
    
    // Add chat message in realtime
    function addRealtimeChatMessage(message) {
        // Don't add if message is from self
        if (message.userId === userId) return;
        
        chatMessages.push(message);
        addMessageToChat(message);
        
        // Play notification sound if not focused
        if (!document.hasFocus()) {
            playNotificationSound();
        }
        
        // Show desktop notification if supported
        if ('Notification' in window && Notification.permission === 'granted') {
            new Notification('ðŸ’¬ Pesan Baru', {
                body: `${message.username || 'User'}: ${message.text}`,
                icon: 'https://cdn-icons-png.flaticon.com/512/2917/2917633.png'
            });
        }
    }
    
    // Update user status in realtime
    function updateUserStatusRealtime(data) {
        if (data.action === 'login') {
            addUserToOnlineList(data.user);
        }
        else if (data.action === 'logout') {
            removeUserFromOnlineList(data.userId);
        }
        else if (data.action === 'update') {
            chatUsers.set(data.user.id, data.user);
            updateOnlineUsersDisplay();
        }
    }
    
    // ========== ADMIN REALTIME FUNCTIONS ==========
    
    // Admin: Send student update to all users
    function updateStudentWithRealtime(studentId, updatedData) {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can update students', 'error');
            return;
        }
        
        const data = loadData();
        const studentIndex = data.students.findIndex(s => s.id === studentId);
        
        if (studentIndex !== -1) {
            data.students[studentIndex] = { ...data.students[studentIndex], ...updatedData };
            saveData('students', data.students);
            
            // Send realtime update
            sendRealtimeUpdate('student-updated', {
                action: 'update',
                student: data.students[studentIndex],
                updatedBy: currentUser,
                timestamp: new Date().toISOString()
            });
            
            // Update local data
            updateStudentRealtime({
                action: 'update',
                student: data.students[studentIndex],
                updatedBy: currentUser
            });
            
            showToast('Berhasil', 'Data siswa diperbarui dan disinkronkan ke semua user', 'success');
        }
    }
    
    // Admin: Delete student with realtime
    function deleteStudentWithRealtime(studentId) {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can delete students', 'error');
            return;
        }
        
        if (confirm('Yakin ingin menghapus siswa ini? Perubahan akan tersinkron ke semua user.')) {
            const data = loadData();
            const student = data.students.find(s => s.id === studentId);
            
            data.students = data.students.filter(s => s.id !== studentId);
            saveData('students', data.students);
            
            // Send realtime update
            sendRealtimeUpdate('student-updated', {
                action: 'delete',
                studentId: studentId,
                studentName: student?.name || 'Unknown',
                deletedBy: currentUser,
                timestamp: new Date().toISOString()
            });
            
            // Update local data
            updateStudentRealtime({
                action: 'delete',
                studentId: studentId,
                deletedBy: currentUser
            });
            
            showToast('Berhasil', 'Siswa dihapus dan perubahan disinkronkan', 'success');
        }
    }
    
    // Admin: Add student with realtime
    function addStudentWithRealtimeDialog() {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can add students', 'error');
            return;
        }
        
        const name = prompt('Nama lengkap siswa:');
        if (!name) return;
        
        const nis = prompt('NIS siswa:');
        const gender = prompt('Jenis kelamin (Laki-laki/Perempuan):');
        
        const newStudent = {
            id: studentsData.length > 0 ? Math.max(...studentsData.map(s => s.id)) + 1 : 1,
            name: name,
            nis: nis || '000',
            gender: gender || 'Laki-laki',
            averageGrade: 0,
            attendance: 0,
            status: 'Aktif',
            achievements: []
        };
        
        const data = loadData();
        data.students.push(newStudent);
        saveData('students', data.students);
        
        // Send realtime update
        sendRealtimeUpdate('student-updated', {
            action: 'add',
            student: newStudent,
            addedBy: currentUser,
            timestamp: new Date().toISOString()
        });
        
        // Update local data
        updateStudentRealtime({
            action: 'add',
            student: newStudent,
            addedBy: currentUser
        });
        
        showToast('Berhasil', 'Siswa ditambahkan dan disinkronkan ke semua user', 'success');
    }
    
    // Admin: Clear all grades with realtime
    function clearAllGradesWithRealtime() {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can reset data', 'error');
            return;
        }
        
        if (confirm('Yakin ingin mereset SEMUA nilai? Tindakan ini tidak dapat dibatalkan dan akan tersinkron ke semua user!')) {
            const data = loadData();
            data.students.forEach(student => {
                student.averageGrade = 0;
                student.attendance = 0;
            });
            saveData('students', data.students);
            
            // Send realtime update
            sendRealtimeUpdate('system-update', {
                type: 'grades-reset',
                resetBy: currentUser,
                timestamp: new Date().toISOString(),
                message: 'Semua nilai telah direset'
            });
            
            // Update local data
            renderStudents();
            
            // Broadcast to all users
            broadcastToAllUsers(
                'Reset Nilai',
                'Admin telah mereset semua nilai siswa. Data telah disinkronkan ke semua user.'
            );
            
            showToast('Berhasil', 'Semua nilai telah direset dan disinkronkan', 'success');
        }
    }
    
    // Admin: Reset voting with realtime
    function resetVotingWithRealtime() {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can reset voting', 'error');
            return;
        }
        
        if (confirm('Reset voting results? Perubahan akan tersinkron ke semua user.')) {
            activeVote.options.forEach(option => option.votes = 0);
            activeVote.totalVotes = 0;
            userVotes.clear();
            saveData('voting', activeVote);
            
            // Send realtime update
            sendRealtimeUpdate('vote-updated', {
                vote: activeVote,
                resetVotes: true,
                resetBy: currentUser,
                timestamp: new Date().toISOString()
            });
            
            // Update local data
            updateVotingRealtime({
                vote: activeVote,
                resetVotes: true,
                updatedBy: currentUser
            });
            
            showToast('Voting Reset', 'All votes have been reset and synchronized', 'success');
        }
    }
    
    // Admin: Delete voting with realtime
    function deleteVotingWithRealtime() {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can delete voting', 'error');
            return;
        }
        
        if (confirm('Delete this voting? Perubahan akan tersinkron ke semua user.')) {
            const oldVote = activeVote;
            activeVote = null;
            saveData('voting', null);
            
            // Send realtime update
            sendRealtimeUpdate('vote-updated', {
                action: 'delete',
                voteId: oldVote?.id,
                deletedBy: currentUser,
                timestamp: new Date().toISOString()
            });
            
            // Update UI
            document.getElementById('activeVoting').innerHTML = '<p class="text-center p-4">No active voting</p>';
            
            showToast('Voting Deleted', 'Voting has been deleted and synchronized', 'success');
        }
    }
    
    // Admin: Clear playlist with realtime
    function clearPlaylistWithRealtime() {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can clear playlist', 'error');
            return;
        }
        
        if (confirm('Clear entire playlist? Perubahan akan tersinkron ke semua user.')) {
            playlist = [];
            saveData('playlist', playlist);
            
            // Send realtime update
            sendRealtimeUpdate('playlist-updated', {
                action: 'clear',
                clearedBy: currentUser,
                timestamp: new Date().toISOString()
            });
            
            // Update local data
            updatePlaylistRealtime({
                action: 'clear',
                clearedBy: currentUser
            });
            
            showToast('Playlist Cleared', 'All tracks removed and synchronized', 'success');
        }
    }
    
    // Admin: Delete all gallery with realtime
    function deleteAllGalleryWithRealtime() {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can delete all media', 'error');
            return;
        }
        
        if (confirm('Delete all media in gallery? Perubahan akan tersinkron ke semua user.')) {
            galleryItems = [];
            saveData('gallery', galleryItems);
            
            // Send realtime update
            sendRealtimeUpdate('gallery-updated', {
                action: 'clear-all',
                clearedBy: currentUser,
                timestamp: new Date().toISOString()
            });
            
            // Update local data
            updateGalleryRealtime({
                action: 'clear-all',
                clearedBy: currentUser
            });
            
            showToast('Gallery Cleared', 'All media removed and synchronized', 'success');
        }
    }
    
    // Admin: Broadcast message to all users
    function broadcastToAllUsers(title, message) {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can broadcast', 'error');
            return;
        }
        
        // Send broadcast via realtime
        sendRealtimeUpdate('admin-broadcast', {
            title: title,
            message: message,
            from: currentUser,
            timestamp: new Date().toISOString()
        });
        
        // Also show to the admin who sent it
        showAdminBroadcast({
            title: title,
            message: message,
            from: currentUser
        });
        
        showToast('Broadcast Sent', 'Pesan telah dikirim ke semua user online', 'success');
    }
    
    function broadcastMessageDialog() {
        const title = prompt('Judul broadcast:', 'Pemberitahuan dari Admin');
        if (!title) return;
        
        const message = prompt('Pesan broadcast:', '');
        if (!message) return;
        
        broadcastToAllUsers(title, message);
    }
    
    // ========== REALTIME HELPER FUNCTIONS ==========
    
    function sendRealtimeUpdate(event, data) {
        // If Pusher is connected, use it
        if (isRealtimeConnected && channels.main) {
            try {
                channels.main.trigger(event, data);
                console.log(`âœ… Sent realtime update: ${event}`, data);
                return true;
            } catch (error) {
                console.error('âŒ Error sending realtime update:', error);
                return false;
            }
        } else {
            // Fallback to polling system
            console.log(`ðŸ“¡ Queued update for polling: ${event}`);
            return false;
        }
    }
    
    function showRealtimeSyncIndicator() {
        const indicator = document.getElementById('realtimeSyncIndicator');
        if (indicator) {
            indicator.classList.add('active');
            indicator.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i><span>Data diperbarui</span>';
            
            setTimeout(() => {
                indicator.classList.remove('active');
            }, 3000);
        }
    }
    
    function showRealtimeNotification(title, message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = 'realtime-notification';
        
        const typeIcons = {
            'info': 'fas fa-info-circle',
            'success': 'fas fa-check-circle',
            'warning': 'fas fa-exclamation-triangle',
            'error': 'fas fa-times-circle'
        };
        
        notification.innerHTML = `
            <div class="card" style="background: var(--gradient-primary); color: white; border: none;">
                <div class="card-body p-3">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <i class="${typeIcons[type] || 'fas fa-info-circle'} fa-2x"></i>
                        <div style="flex: 1;">
                            <h6 style="margin: 0; font-size: 1rem;">${title}</h6>
                            <p style="margin: 5px 0 0; opacity: 0.9; font-size: 0.9rem;">${message}</p>
                        </div>
                        <button class="btn btn-sm" onclick="this.parentElement.parentElement.parentElement.remove()" style="color: white; opacity: 0.8;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // Auto remove after 8 seconds
        setTimeout(() => {
            if (notification.parentElement) {
                notification.remove();
            }
        }, 8000);
        
        // Play notification sound
        playNotificationSound();
    }
    
    function showRealtimeStatus(message, type = 'info') {
        console.log(`ðŸ“¡ Realtime status: ${message}`);
        // You could add a status indicator in the UI
    }
    
    function showAdminBroadcast(data) {
        showRealtimeNotification(
            `ðŸ“¢ ${data.title}`,
            `${data.message}<br><small>From: ${data.from}</small>`,
            'warning'
        );
    }
    
    function showSystemUpdateNotification(data) {
        showRealtimeNotification(
            'âš™ï¸ System Update',
            data.message || 'System has been updated',
            'info'
        );
    }
    
    function playNotificationSound() {
        try {
            // Create a simple notification sound
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
            
        } catch (error) {
            console.log('ðŸ”‡ Notification sound not supported');
        }
    }
    
    // ========== REST OF YOUR EXISTING CODE ==========
    // (Semua kode JavaScript asli Anda tetap di sini tanpa perubahan)
    // Saya hanya menambahkan sistem realtime di atas kode yang sudah ada
    
    // ========== DATA CONFIG ==========
    const defaultStudents = [
        { id: 1, name: "ALAN KHOIRUL", nis: "001", gender: "Laki-laki", averageGrade: 8.5, attendance: 95, status: "Aktif", achievements: ["Sains"] },
        { id: 2, name: "ALBIE ALFARIZA RACHMADHANI", nis: "002", gender: "Laki-laki", averageGrade: 8.7, attendance: 98, status: "Aktif", achievements: ["Matematika"] },
        { id: 3, name: "ALI IQBAL", nis: "003", gender: "Laki-laki", averageGrade: 8.3, attendance: 92, status: "Aktif", achievements: [] },
        { id: 4, name: "ALKILLA AFIFA", nis: "004", gender: "Perempuan", averageGrade: 9.0, attendance: 100, status: "Aktif", achievements: ["Sains", "Matematika"] },
        { id: 5, name: "AMELIA CHANTIKA PRATIWI", nis: "005", gender: "Perempuan", averageGrade: 8.8, attendance: 96, status: "Aktif", achievements: ["Seni"] },
        { id: 6, name: "AN ASBY ANGGARA", nis: "006", gender: "Laki-laki", averageGrade: 8.4, attendance: 94, status: "Aktif", achievements: [] },
        { id: 7, name: "ANISA PRASTYA PUTRI", nis: "007", gender: "Perempuan", averageGrade: 8.9, attendance: 99, status: "Aktif", achievements: ["Bahasa Inggris"] },
        { id: 8, name: "ANTIQA T", nis: "008", gender: "Perempuan", averageGrade: 8.6, attendance: 97, status: "Aktif", achievements: [] },
        { id: 9, name: "AQILAH RAHMAHDHANI ZIKRILLAH", nis: "009", gender: "Perempuan", averageGrade: 8.7, attendance: 95, status: "Aktif", achievements: [] },
        { id: 10, name: "AQILLA AZZALEA ANABIYU", nis: "010", gender: "Perempuan", averageGrade: 8.5, attendance: 93, status: "Aktif", achievements: [] },
        { id: 11, name: "ARYA BANGSA JAYA", nis: "011", gender: "Laki-laki", averageGrade: 8.2, attendance: 91, status: "Aktif", achievements: [] },
        { id: 12, name: "ASHILAH DZAKIYAH", nis: "012", gender: "Perempuan", averageGrade: 8.8, attendance: 98, status: "Aktif", achievements: ["Seni"] },
        { id: 13, name: "ATHA ANASTASYA KHANSA", nis: "013", gender: "Perempuan", averageGrade: 8.9, attendance: 100, status: "Aktif", achievements: ["Sains"] },
        { id: 14, name: "ATIRI HAFIZ FEBRIZIO", nis: "014", gender: "Laki-laki", averageGrade: 8.4, attendance: 94, status: "Aktif", achievements: [] },
        { id: 15, name: "BILQIS ZASKIA ARFAN", nis: "015", gender: "Perempuan", averageGrade: 8.7, attendance: 96, status: "Aktif", achievements: [] },
        { id: 16, name: "CELLO GAVIN SAPUTRA", nis: "016", gender: "Laki-laki", averageGrade: 8.3, attendance: 92, status: "Aktif", achievements: [] },
        { id: 17, name: "DZAKI DZULHANNAN", nis: "017", gender: "Laki-laki", averageGrade: 8.5, attendance: 95, status: "Aktif", achievements: [] },
        { id: 18, name: "GHEZI IQBAL ABIYA", nis: "018", gender: "Laki-laki", averageGrade: 8.6, attendance: 97, status: "Aktif", achievements: [] },
        { id: 19, name: "HANUN KHAIRUNISA", nis: "019", gender: "Perempuan", averageGrade: 8.8, attendance: 99, status: "Aktif", achievements: ["Bahasa Indonesia"] },
        { id: 20, name: "KALILLAH MASYA ANTAMA", nis: "020", gender: "Perempuan", averageGrade: 8.9, attendance: 100, status: "Aktif", achievements: ["Sains"] },
        { id: 21, name: "KEYZA AZZAHRA SHIDIQ", nis: "021", gender: "Perempuan", averageGrade: 8.7, attendance: 98, status: "Aktif", achievements: [] },
        { id: 22, name: "M.ALDO PRATAMA", nis: "022", gender: "Laki-laki", averageGrade: 8.4, attendance: 93, status: "Aktif", achievements: [] },
        { id: 23, name: "MAESYA NAYRA SALSABILLA", nis: "023", gender: "Perempuan", averageGrade: 8.8, attendance: 97, status: "Aktif", achievements: ["Seni"] },
        { id: 24, name: "MAYANG SETIAJI", nis: "024", gender: "Perempuan", averageGrade: 8.6, attendance: 96, status: "Aktif", achievements: [] },
        { id: 25, name: "MUAMMAR TANGGUH RAMDANI", nis: "025", gender: "Laki-laki", averageGrade: 8.5, attendance: 94, status: "Aktif", achievements: [] },
        { id: 26, name: "MUHAMAD SULTAN AZIZ", nis: "026", gender: "Laki-laki", averageGrade: 8.3, attendance: 92, status: "Aktif", achievements: [] },
        { id: 27, name: "MUHAMMAD ABRAHAM ALI HASAN", nis: "027", gender: "Laki-laki", averageGrade: 8.7, attendance: 98, status: "Aktif", achievements: [] },
        { id: 28, name: "MUHAMMAD RAMSES CALM", nis: "028", gender: "Laki-laki", averageGrade: 8.4, attendance: 95, status: "Aktif", achievements: [] },
        { id: 29, name: "MUHAMMAD RASYA ATHAYA", nis: "029", gender: "Laki-laki", averageGrade: 8.6, attendance: 97, status: "Aktif", achievements: [] },
        { id: 30, name: "NASYWA ROHADATUL AISY", nis: "030", gender: "Perempuan", averageGrade: 8.9, attendance: 100, status: "Aktif", achievements: ["Matematika"] },
        { id: 31, name: "QUEEN NAURA GRNETHA AWANG", nis: "031", gender: "Perempuan", averageGrade: 8.8, attendance: 99, status: "Aktif", achievements: [] },
        { id: 32, name: "QURROTA AYUN WULAN RAMADHANI", nis: "032", gender: "Perempuan", averageGrade: 8.7, attendance: 98, status: "Aktif", achievements: [] },
        { id: 33, name: "RAISA AZRA LATIFA", nis: "033", gender: "Perempuan", averageGrade: 8.9, attendance: 100, status: "Aktif", achievements: ["Sains"] },
        { id: 34, name: "YUSUF HISYAMA WIJAYA", nis: "034", gender: "Laki-laki", averageGrade: 9.2, attendance: 100, status: "Aktif", achievements: ["IT", "Matematika", "Sains"] }
    ];
    
    const defaultPlaylist = [
        { id: 1, title: "Lagu Motivasi Belajar", artist: "Kelas 8I", url: "https://example.com/audio1.mp3", category: "music", duration: "3:45", thumbnail: "https://via.placeholder.com/100/6366f1/ffffff?text=ðŸŽµ" },
        { id: 2, title: "Materi Matematika Bab 1", artist: "Bu Ani", url: "https://example.com/audio2.mp3", category: "lecture", duration: "15:20", thumbnail: "https://via.placeholder.com/100/10b981/ffffff?text=ðŸ“š" },
        { id: 3, title: "Podcast Inspirasi", artist: "Tim 8I", url: "https://example.com/audio3.mp3", category: "podcast", duration: "28:15", thumbnail: "https://via.placeholder.com/100/f472b6/ffffff?text=ðŸŽ™" }
    ];
    
    const defaultGallery = [
        { id: 1, url: "https://files.catbox.moe/example1.jpg", title: "Kegiatan Belajar Kelas", desc: "Siswa sedang belajar bersama", category: "foto", type: "image" },
        { id: 2, url: "https://files.catbox.moe/example2.jpg", title: "Diskusi Kelompok", desc: "Diskusi kelompok mata pelajaran IPA", category: "foto", type: "image" },
        { id: 3, url: "https://files.catbox.moe/example3.mp4", title: "Video Presentasi", desc: "Presentasi hasil tugas kelompok", category: "video", type: "video" },
        { id: 4, url: "https://files.catbox.moe/example4.jpg", title: "Eksperimen IPA", desc: "Praktikum IPA di laboratorium", category: "kegiatan", type: "image" },
        { id: 5, url: "https://files.catbox.moe/example5.jpg", title: "Kegiatan Olahraga", desc: "Kegiatan PJOK di lapangan", category: "kegiatan", type: "image" }
    ];
    
    const defaultVoting = {
        id: 1,
        question: "Pilih Ketua Kelas Baru",
        description: "Pilih salah satu calon ketua kelas untuk periode mendatang",
        options: [
            { id: 1, text: "Yusuf Hisyama", votes: 12 },
            { id: 2, text: "Alkilla Afifa", votes: 8 },
            { id: 3, text: "Nasywa Rohadatul", votes: 6 },
            { id: 4, text: "M. Abraham", votes: 4 }
        ],
        totalVotes: 30,
        endTime: "2024-12-31T23:59:59",
        isActive: true
    };
    
    // ========== LOCAL STORAGE MANAGEMENT ==========
    function loadData() {
        const students = localStorage.getItem('portal8i_students');
        const playlist = localStorage.getItem('portal8i_playlist');
        const gallery = localStorage.getItem('portal8i_gallery');
        const voting = localStorage.getItem('portal8i_voting');
        const chat = localStorage.getItem('portal8i_chat');
        const users = localStorage.getItem('portal8i_users');
        const settings = localStorage.getItem('portal8i_settings');
        
        return {
            students: students ? JSON.parse(students) : defaultStudents,
            playlist: playlist ? JSON.parse(playlist) : defaultPlaylist,
            gallery: gallery ? JSON.parse(gallery) : defaultGallery,
            voting: voting ? JSON.parse(voting) : defaultVoting,
            chat: chat ? JSON.parse(chat) : [],
            users: users ? JSON.parse(users) : [],
            settings: settings ? JSON.parse(settings) : { theme: 'dark', notifications: true }
        };
    }
    
    function saveData(key, data) {
        localStorage.setItem(`portal8i_${key}`, JSON.stringify(data));
    }
    
    // ========== AUTHENTICATION ==========
    function checkLogin() {
        const user = localStorage.getItem('portal8i_current_user');
        if (user) {
            const userData = JSON.parse(user);
            currentUser = userData.username;
            userRole = userData.role;
            userId = userData.id;
            isAdmin = ['admin', 'guru', 'wali_kelas'].includes(userRole);
            updateUIForLogin();
            
            // Add user to online list
            addUserToOnlineList(userData);
            
            // Send login notification to other users
            if (isRealtimeConnected) {
                sendRealtimeUpdate('user-status', {
                    action: 'login',
                    user: userData,
                    timestamp: new Date().toISOString()
                });
            }
            
            return true;
        }
        return false;
    }
    
    function login(username, password, role, fullName) {
        const credentials = [
            { id: 1, username: 'admin8i', password: 'password123', role: 'admin', fullName: 'Admin Kelas 8I' },
            { id: 2, username: 'yama', password: 'yama123', role: 'admin', fullName: 'Yusuf Hisyama' },
            { id: 3, username: 'guru', password: 'password123', role: 'guru', fullName: 'Guru Wali Kelas' },
            { id: 4, username: 'siswa1', password: 'siswa123', role: 'siswa', fullName: 'Alan Khoirul' },
            { id: 5, username: 'ortu1', password: 'ortu123', role: 'orang_tua', fullName: 'Orang Tua Siswa' }
        ];
        
        const validUser = credentials.find(
            cred => cred.username === username && cred.password === password
        );
        
        if (validUser) {
            currentUser = validUser.username;
            userRole = role || validUser.role;
            userId = validUser.id;
            isAdmin = ['admin', 'guru', 'wali_kelas'].includes(userRole);
            
            const userData = {
                id: userId,
                username: currentUser,
                role: userRole,
                fullName: fullName || validUser.fullName,
                loginTime: new Date().toISOString(),
                lastSeen: new Date().toISOString(),
                isOnline: true
            };
            
            localStorage.setItem('portal8i_current_user', JSON.stringify(userData));
            
            // Update users list
            const data = loadData();
            const existingUser = data.users.find(u => u.id === userId);
            if (!existingUser) {
                data.users.push(userData);
                saveData('users', data.users);
            }
            
            updateUIForLogin();
            showToast('Login Berhasil', `Selamat datang, ${userData.fullName}!`, 'success');
            closeModal('loginModal');
            
            // Add to online users
            addUserToOnlineList(userData);
            
            // Send login notification
            if (isRealtimeConnected) {
                sendRealtimeUpdate('user-status', {
                    action: 'login',
                    user: userData,
                    timestamp: new Date().toISOString()
                });
            }
            
            // Start chat connection
            startChatConnection();
            
            return true;
        } else {
            showToast('Login Gagal', 'Username atau password salah!', 'error');
            return false;
        }
    }
    
    function logout() {
        if (currentUser) {
            // Send logout notification
            if (isRealtimeConnected) {
                sendRealtimeUpdate('user-status', {
                    action: 'logout',
                    userId: userId,
                    username: currentUser,
                    timestamp: new Date().toISOString()
                });
            }
            
            // Remove from online users
            removeUserFromOnlineList(userId);
            
            // Stop chat connection
            stopChatConnection();
        }
        
        currentUser = null;
        userRole = '';
        userId = null;
        isAdmin = false;
        localStorage.removeItem('portal8i_current_user');
        updateUIForLogout();
        showToast('Logout Berhasil', 'Anda telah keluar dari sistem', 'success');
    }
    
    function updateUIForLogin() {
        const userSection = document.getElementById('userSection');
        const roleColors = {
            admin: 'linear-gradient(135deg, #6366f1, #4f46e5)',
            guru: 'linear-gradient(135deg, #10b981, #059669)',
            wali_kelas: 'linear-gradient(135deg, #f59e0b, #d97706)',
            orang_tua: 'linear-gradient(135deg, #8b5cf6, #7c3aed)',
            siswa: 'linear-gradient(135deg, #06b6d4, #0891b2)'
        };
        
        const userData = JSON.parse(localStorage.getItem('portal8i_current_user'));
        
        userSection.innerHTML = `
            <div class="flex items-center gap-3">
                <div style="display:flex; align-items:center; gap:12px; padding:8px 20px; background:${roleColors[userRole] || 'var(--gradient-primary)'}; border-radius:var(--radius); color:white; font-weight:600;">
                    <div style="width:40px; height:40px; border-radius:50%; background:rgba(255,255,255,0.2); display:flex; align-items:center; justify-content:center; color:white; font-weight:600; border:2px solid white;">
                        ${userData.fullName?.charAt(0) || currentUser?.charAt(0) || 'U'}
                    </div>
                    <div>
                        <div style="font-weight:700; font-size:14px;">${userData.fullName || currentUser}</div>
                        <div style="font-size:11px; opacity:0.9; text-transform:capitalize;">${userRole.replace('_', ' ')}</div>
                    </div>
                </div>
                <button class="btn btn-sm btn-outline" onclick="logout()" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        `;
        
        document.querySelectorAll('.admin-controls').forEach(el => {
            if (isAdmin) {
                el.classList.add('show');
            }
        });
        
        document.querySelectorAll('.admin-only').forEach(el => {
            if (isAdmin) {
                el.classList.add('show');
            }
        });
    }
    
    function updateUIForLogout() {
        const userSection = document.getElementById('userSection');
        userSection.innerHTML = `
            <button id="loginBtn" class="btn btn-neon btn-sm">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
        `;
        
        document.querySelectorAll('.admin-controls').forEach(el => {
            el.classList.remove('show');
        });
        
        document.querySelectorAll('.admin-only').forEach(el => {
            el.classList.remove('show');
        });
        
        document.getElementById('loginBtn').addEventListener('click', () => {
            openModal('loginModal');
        });
    }
    
    // ========== UI FUNCTIONS ==========
    function showToast(title, message, type = 'success') {
        const toast = document.getElementById('toast');
        const toastTitle = document.getElementById('toastTitle');
        const toastMessage = document.getElementById('toastMessage');
        const toastIcon = document.getElementById('toastIcon');
        
        toastTitle.textContent = title;
        toastMessage.textContent = message;
        
        const icons = {
            success: 'fa-check-circle',
            error: 'fa-times-circle',
            warning: 'fa-exclamation-triangle',
            info: 'fa-info-circle'
        };
        
        const colors = {
            success: '#10b981',
            error: '#ef4444',
            warning: '#f59e0b',
            info: '#06b6d4'
        };
        
        toastIcon.innerHTML = `<i class="fas ${icons[type]}" style="color: ${colors[type]}"></i>`;
        toast.style.borderLeftColor = colors[type];
        
        toast.classList.add('active');
        
        setTimeout(() => {
            if (toast.classList.contains('active')) {
                toast.classList.remove('active');
            }
        }, 4000);
    }
    
    function closeToast() {
        document.getElementById('toast').classList.remove('active');
    }
    
    function openModal(modalId) {
        document.getElementById(modalId).classList.add('active');
    }
    
    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
    }
    
    // ========== LOADING ANIMATION ==========
    function simulateLoading() {
        let progress = 0;
        const progressBar = document.getElementById('loadingProgress');
        const loader = document.getElementById('loader');
        
        const interval = setInterval(() => {
            progress += Math.random() * 15;
            if (progress > 100) progress = 100;
            progressBar.style.width = progress + '%';
            
            if (progress >= 100) {
                clearInterval(interval);
                setTimeout(() => {
                    loader.style.opacity = '0';
                    setTimeout(() => {
                        loader.style.display = 'none';
                        
                        // Initialize realtime system after loading
                        setTimeout(initializeRealtimeSystem, 1000);
                    }, 500);
                }, 500);
            }
        }, 100);
    }
    
    // ========== COUNTDOWN TIMER ==========
    function updateCountdown() {
        const examDate = new Date('2024-06-15T08:00:00');
        const now = new Date();
        const diff = examDate - now;
        
        if (diff > 0) {
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('days').textContent = days.toString().padStart(2, '0');
            document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
            document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
        } else {
            document.getElementById('examCountdown').innerHTML = '<div class="text-2xl font-bold text-gradient">Ujian Telah Dimulai!</div>';
        }
    }
    
    // ========== DATA SISWA FUNCTIONS ==========
    function renderStudents() {
        const data = loadData();
        studentsData = data.students.sort((a, b) => b.averageGrade - a.averageGrade);
        const tableBody = document.getElementById('studentsTableBody');
        tableBody.innerHTML = '';
        
        let maleCount = 0;
        let femaleCount = 0;
        
        studentsData.forEach((student, index) => {
            if (student.gender === 'Laki-laki') maleCount++;
            if (student.gender === 'Perempuan') femaleCount++;
            
            const rank = index + 1;
            const rankClass = rank <= 3 ? 'badge-gold' : rank <= 10 ? 'badge-primary' : 'badge-success';
            const rankText = rank <= 3 ? `<i class="fas fa-crown"></i> ${rank}` : rank;
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>
                    <span class="badge ${rankClass}">${rankText}</span>
                </td>
                <td>
                    <div style="display:flex; align-items:center; gap:12px;">
                        <div style="width:45px; height:45px; border-radius:50%; background:var(--gradient-primary); display:flex; align-items:center; justify-content:center; color:white; font-weight:700; font-size:1.2rem;">
                            ${student.name.charAt(0)}
                        </div>
                        <div>
                            <div style="font-weight:700;">${student.name}</div>
                            <div style="font-size:12px; opacity:0.7; display:flex; gap:5px;">
                                <span>${student.gender}</span>
                                <span>â€¢</span>
                                <span>${student.nis}</span>
                            </div>
                        </div>
                    </div>
                </td>
                <td>
                    <span class="badge badge-primary">${student.nis}</span>
                </td>
                <td>
                    <div style="display:flex; align-items:center; gap:12px;">
                        <div style="flex:1; height:10px; background:rgba(255,255,255,0.1); border-radius:var(--radius-full); overflow:hidden;">
                            <div style="width:${(student.averageGrade / 10) * 100}%; height:100%; background:var(--gradient-primary);"></div>
                        </div>
                        <span style="font-weight:700; font-size:1.1rem; color:var(--primary);">${student.averageGrade.toFixed(1)}</span>
                    </div>
                </td>
                <td>
                    <div style="display:flex; align-items:center; gap:8px;">
                        <span class="badge ${student.attendance >= 95 ? 'badge-success' : student.attendance >= 85 ? 'badge-warning' : 'badge-danger'}">
                            ${student.attendance}%
                        </span>
                        <div style="width:50px; height:6px; background:rgba(255,255,255,0.1); border-radius:3px; overflow:hidden;">
                            <div style="width:${student.attendance}%; height:100%; background:${student.attendance >= 95 ? 'var(--success)' : student.attendance >= 85 ? 'var(--warning)' : 'var(--danger)'};"></div>
                        </div>
                    </div>
                </td>
                <td>
                    <span class="badge ${student.status === 'Aktif' ? 'badge-success' : 'badge-danger'}">
                        ${student.status}
                    </span>
                </td>
                <td>
                    <div style="display:flex; gap:4px; flex-wrap:wrap;">
                        ${student.achievements && student.achievements.length > 0 
                            ? student.achievements.map(ach => `<span class="badge badge-neon" style="font-size:10px; padding:2px 6px;">${ach}</span>`).join('')
                            : '<span style="opacity:0.6; font-size:12px;">-</span>'}
                    </div>
                </td>
                <td class="admin-only">
                    <div style="display:flex; gap:5px;">
                        <button class="btn btn-sm btn-outline" onclick="editStudent(${student.id})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline" onclick="viewStudent(${student.id})" title="Detail">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline" onclick="deleteStudentWithRealtime(${student.id})" title="Hapus">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
            tableBody.appendChild(row);
        });
        
        document.getElementById('studentCount').textContent = studentsData.length;
        document.getElementById('maleCount').textContent = maleCount;
        document.getElementById('femaleCount').textContent = femaleCount;
        
        updateStats(studentsData);
        updateRankingList(studentsData.slice(0, 10));
        initRankingChart(studentsData.slice(0, 10));
    }
    
    function updateStats(students) {
        document.getElementById('totalStudents').textContent = students.length;
        
        const totalAverage = students.reduce((sum, student) => sum + student.averageGrade, 0) / students.length;
        document.getElementById('averageGrade').textContent = totalAverage.toFixed(1);
        
        const totalAttendance = students.reduce((sum, student) => sum + student.attendance, 0) / students.length;
        document.getElementById('attendanceRate').textContent = Math.round(totalAttendance) + '%';
        
        // Update online users count
        const onlineUsers = chatUsers.size;
        document.getElementById('onlineUsers').textContent = onlineUsers;
        document.getElementById('onlineUsersCount').textContent = onlineUsers;
    }
    
    // ========== LIVE STREAM FUNCTIONS ==========
    let cameraStream = null;
    let screenStream = null;
    let isStreaming = false;
    let isCameraOn = false;
    let isMicOn = true;
    let isScreenSharing = false;
    let viewers = 0;
    
    async function toggleCamera() {
        const preview = document.getElementById('cameraPreview');
        const toggleBtn = document.getElementById('cameraToggle');
        
        if (!isCameraOn) {
            try {
                cameraStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }, 
                    audio: true 
                });
                
                preview.srcObject = cameraStream;
                isCameraOn = true;
                toggleBtn.innerHTML = '<i class="fas fa-camera-slash"></i> Stop Camera';
                toggleBtn.classList.remove('btn-danger');
                toggleBtn.classList.add('btn-outline');
                
                document.getElementById('liveIndicator').style.display = 'flex';
                showToast('Camera Started', 'Camera streaming has started', 'success');
                
                // Start updating viewer count
                startViewerCounter();
                
            } catch (err) {
                console.error('Error accessing camera:', err);
                showToast('Camera Error', 'Could not access camera', 'error');
            }
        } else {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                preview.srcObject = null;
                isCameraOn = false;
                toggleBtn.innerHTML = '<i class="fas fa-camera"></i> Start Camera';
                toggleBtn.classList.remove('btn-outline');
                toggleBtn.classList.add('btn-danger');
                
                document.getElementById('liveIndicator').style.display = 'none';
                showToast('Camera Stopped', 'Camera streaming has stopped', 'info');
                
                // Stop viewer counter
                stopViewerCounter();
            }
        }
    }
    
    async function toggleScreenShare() {
        const preview = document.getElementById('cameraPreview');
        
        try {
            if (!isScreenSharing) {
                screenStream = await navigator.mediaDevices.getDisplayMedia({ 
                    video: true,
                    audio: true 
                });
                
                preview.srcObject = screenStream;
                isScreenSharing = true;
                showToast('Screen Sharing Started', 'Your screen is now being shared', 'success');
                
                screenStream.getVideoTracks()[0].onended = () => {
                    toggleScreenShare();
                };
            } else {
                screenStream.getTracks().forEach(track => track.stop());
                preview.srcObject = cameraStream;
                isScreenSharing = false;
                showToast('Screen Sharing Stopped', 'Screen sharing has ended', 'info');
            }
        } catch (err) {
            console.error('Screen share error:', err);
            showToast('Screen Share Error', 'Could not share screen', 'error');
        }
    }
    
    function toggleMicrophone() {
        const micBtn = document.getElementById('micToggle');
        
        if (cameraStream) {
            const audioTracks = cameraStream.getAudioTracks();
            if (audioTracks.length > 0) {
                isMicOn = !audioTracks[0].enabled;
                audioTracks[0].enabled = isMicOn;
                
                micBtn.innerHTML = isMicOn ? 
                    '<i class="fas fa-microphone"></i> Mic On' : 
                    '<i class="fas fa-microphone-slash"></i> Mic Off';
                    
                showToast(isMicOn ? 'Microphone On' : 'Microphone Off', 
                         `Microphone is now ${isMicOn ? 'on' : 'off'}`, 'info');
            }
        }
    }
    
    function startViewerCounter() {
        // Simulate viewer count increase
        viewers = Math.floor(Math.random() * 10) + 5;
        updateViewerCount();
        
        viewerInterval = setInterval(() => {
            // Randomly change viewer count
            const change = Math.random() > 0.5 ? 1 : -1;
            viewers = Math.max(1, viewers + change);
            updateViewerCount();
        }, 5000);
    }
    
    function stopViewerCounter() {
        if (viewerInterval) {
            clearInterval(viewerInterval);
            viewers = 0;
            updateViewerCount();
        }
    }
    
    function updateViewerCount() {
        document.getElementById('viewers').textContent = viewers;
        document.getElementById('viewerCount').style.display = viewers > 0 ? 'flex' : 'none';
    }
    
    function takeSnapshot() {
        const preview = document.getElementById('cameraPreview');
        const canvas = document.createElement('canvas');
        canvas.width = preview.videoWidth;
        canvas.height = preview.videoHeight;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(preview, 0, 0, canvas.width, canvas.height);
        
        // Create download link
        const link = document.createElement('a');
        link.download = `snapshot-${new Date().getTime()}.jpg`;
        link.href = canvas.toDataURL('image/jpeg');
        link.click();
        
        showToast('Snapshot Taken', 'Screenshot saved successfully', 'success');
    }
    
    function startLiveStream() {
        if (!isCameraOn) {
            showToast('Camera Required', 'Please start camera first', 'warning');
            return;
        }
        
        isStreaming = true;
        showToast('Live Stream Started', 'Stream is now live!', 'success');
        
        // Send broadcast notification
        broadcastToAllUsers('Live Stream Started', 'Live streaming dari kelas telah dimulai');
        
        // Update stream stats
        updateStreamStats();
    }
    
    function stopLiveStream() {
        isStreaming = false;
        showToast('Live Stream Stopped', 'Stream has ended', 'info');
    }
    
    function updateStreamStats() {
        if (isStreaming) {
            const bitrate = Math.floor(Math.random() * 2000) + 1000;
            const fps = Math.floor(Math.random() * 15) + 20;
            const resolution = isScreenSharing ? '1920x1080' : '1280x720';
            
            document.getElementById('bitrate').textContent = bitrate;
            document.getElementById('fps').textContent = fps;
            document.getElementById('resolution').textContent = resolution;
            
            setTimeout(updateStreamStats, 2000);
        }
    }
    
    // ========== VOTING FUNCTIONS ==========
    function initVoting() {
        const data = loadData();
        activeVote = data.voting;
        userVotes = new Map();
        
        renderVoting();
        renderVotingHistory();
    }
    
    function renderVoting() {
        if (!activeVote) return;
        
        document.getElementById('voteQuestion').textContent = activeVote.question;
        document.getElementById('voteTime').textContent = new Date(activeVote.endTime).toLocaleTimeString();
        document.getElementById('totalVotes').textContent = activeVote.totalVotes;
        
        const voteOptions = document.getElementById('voteOptions');
        voteOptions.innerHTML = '';
        
        activeVote.options.forEach(option => {
            const percentage = activeVote.totalVotes > 0 ? 
                Math.round((option.votes / activeVote.totalVotes) * 100) : 0;
            
            const optionDiv = document.createElement('div');
            optionDiv.className = 'vote-option';
            optionDiv.dataset.optionId = option.id;
            optionDiv.onclick = () => selectVoteOption(option.id);
            
            optionDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h5 style="margin: 0;">${option.text}</h5>
                        <p style="margin: 5px 0 0; opacity: 0.8;">${option.votes} votes (${percentage}%)</p>
                    </div>
                    <div class="vote-checkbox" style="width: 20px; height: 20px; border-radius: 50%; border: 2px solid var(--primary);"></div>
                </div>
                <div class="vote-percentage-bar" style="width: ${percentage}%"></div>
            `;
            
            voteOptions.appendChild(optionDiv);
        });
        
        // Check if user has voted
        if (userId && userVotes.has(userId)) {
            const votedOption = userVotes.get(userId);
            document.querySelector(`[data-option-id="${votedOption}"]`).classList.add('selected');
            document.getElementById('submitVoteBtn').disabled = true;
            document.getElementById('submitVoteBtn').innerHTML = '<i class="fas fa-check"></i> Already Voted';
        }
    }
    
    function selectVoteOption(optionId) {
        if (!userId) {
            showToast('Login Required', 'Please login to vote', 'warning');
            return;
        }
        
        // Remove selection from all options
        document.querySelectorAll('.vote-option').forEach(opt => {
            opt.classList.remove('selected');
        });
        
        // Select clicked option
        const selectedOption = document.querySelector(`[data-option-id="${optionId}"]`);
        selectedOption.classList.add('selected');
        
        userVotes.set(userId, optionId);
        document.getElementById('submitVoteBtn').disabled = false;
    }
    
    function submitVote() {
        if (!userId) {
            showToast('Login Required', 'Please login to vote', 'warning');
            return;
        }
        
        const selectedOption = userVotes.get(userId);
        if (!selectedOption) {
            showToast('No Option Selected', 'Please select an option first', 'warning');
            return;
        }
        
        // Update vote count
        const optionIndex = activeVote.options.findIndex(opt => opt.id === selectedOption);
        if (optionIndex !== -1) {
            activeVote.options[optionIndex].votes++;
            activeVote.totalVotes++;
            
            // Save to localStorage
            saveData('voting', activeVote);
            
            // Send realtime update
            sendRealtimeUpdate('vote-updated', {
                vote: activeVote,
                votedBy: currentUser,
                timestamp: new Date().toISOString()
            });
            
            // Disable voting button
            document.getElementById('submitVoteBtn').disabled = true;
            document.getElementById('submitVoteBtn').innerHTML = '<i class="fas fa-check"></i> Voted';
            
            showToast('Vote Submitted', 'Your vote has been recorded', 'success');
            
            // Update display
            renderVoting();
            
            // Add to voting history
            addVotingHistory();
        }
    }
    
    function showResults() {
        document.getElementById('voteResults').classList.add('show');
        renderVoteChart();
    }
    
    function renderVoteChart() {
        const ctx = document.getElementById('voteChart').getContext('2d');
        
        if (window.voteChartInstance) {
            window.voteChartInstance.destroy();
        }
        
        const labels = activeVote.options.map(opt => opt.text);
        const data = activeVote.options.map(opt => opt.votes);
        
        window.voteChartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Votes',
                    data: data,
                    backgroundColor: [
                        'rgba(99, 102, 241, 0.8)',
                        'rgba(16, 185, 129, 0.8)',
                        'rgba(245, 158, 11, 0.8)',
                        'rgba(239, 68, 68, 0.8)',
                        'rgba(139, 92, 246, 0.8)'
                    ],
                    borderColor: [
                        'rgba(99, 102, 241, 1)',
                        'rgba(16, 185, 129, 1)',
                        'rgba(245, 158, 11, 1)',
                        'rgba(239, 68, 68, 1)',
                        'rgba(139, 92, 246, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const percentage = Math.round((context.raw / activeVote.totalVotes) * 100);
                                return `${context.raw} votes (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });
    }
    
    function renderVotingHistory() {
        const historyContainer = document.getElementById('votingHistory');
        historyContainer.innerHTML = '';
        
        votingHistory.forEach(vote => {
            const historyCard = document.createElement('div');
            historyCard.className = 'card card-glass';
            historyCard.innerHTML = `
                <div class="card-body">
                    <h6>${vote.question}</h6>
                    <p style="font-size: 0.9rem; opacity: 0.8; margin: 5px 0;">${vote.totalVotes} votes</p>
                    <div style="font-size: 0.8rem; opacity: 0.6;">
                        ${new Date(vote.date).toLocaleDateString()}
                    </div>
                </div>
            `;
            historyContainer.appendChild(historyCard);
        });
    }
    
    function addVotingHistory() {
        votingHistory.unshift({
            question: activeVote.question,
            totalVotes: activeVote.totalVotes,
            date: new Date().toISOString()
        });
        
        if (votingHistory.length > 6) {
            votingHistory.pop();
        }
        
        renderVotingHistory();
    }
    
    // ========== PLAYLIST FUNCTIONS ==========
    function initPlaylist() {
        const data = loadData();
        playlist = data.playlist;
        renderPlaylist();
        renderRecentTracks();
    }
    
    function renderPlaylist() {
        const container = document.getElementById('playlistContainer');
        container.innerHTML = '';
        
        playlist.forEach((track, index) => {
            const item = document.createElement('div');
            item.className = `playlist-item ${index === currentTrackIndex ? 'active' : ''}`;
            item.onclick = () => playTrack(index);
            
            item.innerHTML = `
                <div class="playlist-thumbnail" style="background: linear-gradient(135deg, ${getTrackColor(index)}, ${getTrackColor(index, true)});">
                    <i class="fas fa-music"></i>
                </div>
                <div style="flex: 1;">
                    <div style="font-weight: 600;">${track.title}</div>
                    <div style="font-size: 0.9rem; opacity: 0.8;">${track.artist} â€¢ ${track.duration}</div>
                </div>
                <button class="btn btn-sm btn-outline" onclick="event.stopPropagation(); removeFromPlaylist(${track.id})">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            
            container.appendChild(item);
        });
    }
    
    function renderRecentTracks() {
        const container = document.getElementById('recentTracks');
        container.innerHTML = '';
        
        // Get recent tracks (last 4)
        const recent = playlist.slice(-4);
        
        recent.forEach((track, index) => {
            const card = document.createElement('div');
            card.className = 'card card-glass text-center p-3';
            card.onclick = () => playTrack(playlist.findIndex(t => t.id === track.id));
            
            card.innerHTML = `
                <div style="width: 60px; height: 60px; border-radius: var(--radius); margin: 0 auto 10px; background: linear-gradient(135deg, ${getTrackColor(index)}, ${getTrackColor(index, true)}); display: flex; align-items: center; justify-content: center; color: white;">
                    <i class="fas fa-music"></i>
                </div>
                <div style="font-weight: 600; font-size: 0.9rem; margin-bottom: 5px;">${track.title}</div>
                <div style="font-size: 0.8rem; opacity: 0.7;">${track.artist}</div>
            `;
            
            container.appendChild(card);
        });
    }
    
    function getTrackColor(index, darken = false) {
        const colors = [
            '#6366f1', '#10b981', '#f59e0b', '#ef4444', 
            '#8b5cf6', '#06b6d4', '#f472b6', '#84cc16'
        ];
        const color = colors[index % colors.length];
        
        if (darken) {
            // Simple darken function
            return color.replace(')', ', 0.8)').replace('rgb', 'rgba');
        }
        return color;
    }
    
    function playTrack(index) {
        if (index < 0 || index >= playlist.length) return;
        
        currentTrackIndex = index;
        const track = playlist[index];
        
        audioPlayer.src = track.url;
        audioPlayer.play();
        isPlaying = true;
        
        updatePlayButton();
        updateCurrentTrackInfo();
        highlightPlayingTrack();
        
        showToast('Now Playing', track.title, 'success');
    }
    
    function togglePlay() {
        if (!playlist.length) return;
        
        if (currentTrackIndex === -1) {
            playTrack(0);
        } else {
            if (isPlaying) {
                audioPlayer.pause();
            } else {
                audioPlayer.play();
            }
            isPlaying = !isPlaying;
            updatePlayButton();
        }
    }
    
    function updatePlayButton() {
        const btn = document.getElementById('playBtn');
        btn.innerHTML = isPlaying ? 
            '<i class="fas fa-pause"></i>' : 
            '<i class="fas fa-play"></i>';
    }
    
    function updateCurrentTrackInfo() {
        if (currentTrackIndex >= 0 && currentTrackIndex < playlist.length) {
            const track = playlist[currentTrackIndex];
            document.getElementById('currentTrack').textContent = `${track.title} - ${track.artist}`;
        }
    }
    
    function highlightPlayingTrack() {
        document.querySelectorAll('.playlist-item').forEach((item, index) => {
            if (index === currentTrackIndex) {
                item.classList.add('active');
            } else {
                item.classList.remove('active');
            }
        });
    }
    
    function playNext() {
        if (playlist.length === 0) return;
        
        currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
        playTrack(currentTrackIndex);
    }
    
    function playPrevious() {
        if (playlist.length === 0) return;
        
        currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
        playTrack(currentTrackIndex);
    }
    
    function toggleMute() {
        audioPlayer.muted = !audioPlayer.muted;
        const icon = document.getElementById('volumeIcon');
        icon.innerHTML = audioPlayer.muted ? 
            '<i class="fas fa-volume-mute"></i>' : 
            '<i class="fas fa-volume-up"></i>';
    }
    
    function openAddPlaylistFromCatbox() {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can add to playlist', 'error');
            return;
        }
        
        openModal('catboxModal');
    }
    
    function addFromCatbox(url, title, artist, category) {
        const newId = playlist.length > 0 ? Math.max(...playlist.map(t => t.id)) + 1 : 1;
        
        const newTrack = {
            id: newId,
            title: title,
            artist: artist,
            url: url,
            category: category,
            duration: '0:00',
            thumbnail: 'https://via.placeholder.com/100/6366f1/ffffff?text=ðŸŽµ',
            addedAt: new Date().toISOString()
        };
        
        playlist.push(newTrack);
        saveData('playlist', playlist);
        
        // Send realtime update
        sendRealtimeUpdate('playlist-updated', {
            action: 'add',
            track: newTrack,
            addedBy: currentUser,
            timestamp: new Date().toISOString()
        });
        
        renderPlaylist();
        renderRecentTracks();
        
        showToast('Track Added', `${title} added to playlist`, 'success');
        closeModal('catboxModal');
    }
    
    function removeFromPlaylist(id) {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can remove tracks', 'error');
            return;
        }
        
        const track = playlist.find(t => t.id === id);
        playlist = playlist.filter(track => track.id !== id);
        saveData('playlist', playlist);
        
        // Send realtime update
        sendRealtimeUpdate('playlist-updated', {
            action: 'delete',
            trackId: id,
            trackName: track?.title || 'Unknown',
            deletedBy: currentUser,
            timestamp: new Date().toISOString()
        });
        
        renderPlaylist();
        renderRecentTracks();
        
        showToast('Track Removed', 'Track removed from playlist', 'success');
    }
    
    // ========== GALERI FUNCTIONS ==========
    function initGallery() {
        const data = loadData();
        galleryItems = data.gallery;
        renderGallery();
    }
    
    function renderGallery() {
        const grid = document.getElementById('galleryGrid');
        grid.innerHTML = '';
        
        galleryItems.forEach(item => {
            const galleryItem = document.createElement('div');
            galleryItem.className = 'gallery-item';
            galleryItem.dataset.category = item.category;
            
            if (item.type === 'video') {
                galleryItem.innerHTML = `
                    <video class="gallery-img" controls poster="https://via.placeholder.com/300/1e293b/ffffff?text=VIDEO">
                        <source src="${item.url}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="gallery-overlay">
                        <div style="display:flex; justify-content:space-between; align-items:start;">
                            <div>
                                <div style="font-weight:700; margin-bottom:5px; font-size:1.1rem;">${item.title}</div>
                                <div style="font-size:12px; opacity:0.9;">${item.desc || ''}</div>
                            </div>
                            <span class="badge badge-primary">${item.category}</span>
                        </div>
                        ${isAdmin || userRole === 'guru' ? `
                        <div style="margin-top:15px; display:flex; gap:5px;">
                            <button class="btn btn-sm btn-outline" onclick="shareMedia('${item.url}')" style="padding:3px 8px; font-size:11px;">
                                <i class="fas fa-share"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" onclick="deleteGalleryItem(${item.id})" style="padding:3px 8px; font-size:11px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        ` : ''}
                    </div>
                `;
            } else {
                galleryItem.innerHTML = `
                    <img src="${item.url}" alt="${item.title}" class="gallery-img" loading="lazy" onerror="this.src='https://via.placeholder.com/500?text=Gambar+Tidak+Tersedia'">
                    <div class="gallery-overlay">
                        <div style="display:flex; justify-content:space-between; align-items:start;">
                            <div>
                                <div style="font-weight:700; margin-bottom:5px; font-size:1.1rem;">${item.title}</div>
                                <div style="font-size:12px; opacity:0.9;">${item.desc || ''}</div>
                            </div>
                            <span class="badge badge-primary">${item.category}</span>
                        </div>
                        ${isAdmin || userRole === 'guru' ? `
                        <div style="margin-top:15px; display:flex; gap:5px;">
                            <button class="btn btn-sm btn-outline" onclick="downloadMedia('${item.url}')" style="padding:3px 8px; font-size:11px;">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" onclick="shareMedia('${item.url}')" style="padding:3px 8px; font-size:11px;">
                                <i class="fas fa-share"></i>
                            </button>
                            <button class="btn btn-sm btn-outline" onclick="deleteGalleryItem(${item.id})" style="padding:3px 8px; font-size:11px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        ` : ''}
                    </div>
                `;
            }
            
            grid.appendChild(galleryItem);
        });
    }
    
    function openCatboxModal() {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can add media', 'error');
            return;
        }
        
        openModal('catboxGalleryModal');
    }
    
    function toggleCatboxMediaType() {
        const type = document.getElementById('catboxMediaType').value;
        const preview = document.getElementById('catboxPreview');
        
        if (type === 'video') {
            preview.innerHTML = '<p style="opacity: 0.7;">Video preview will appear after URL is entered</p>';
        } else {
            preview.innerHTML = '<p style="opacity: 0.7;">Image preview will appear after URL is entered</p>';
        }
    }
    
    function addMediaFromCatbox(url, title, type, category, description) {
        const newId = galleryItems.length > 0 ? Math.max(...galleryItems.map(g => g.id)) + 1 : 1;
        
        const newMedia = {
            id: newId,
            url: url,
            title: title,
            desc: description,
            category: category,
            type: type,
            addedAt: new Date().toISOString(),
            addedBy: currentUser
        };
        
        galleryItems.push(newMedia);
        saveData('gallery', galleryItems);
        
        // Send realtime update
        sendRealtimeUpdate('gallery-updated', {
            action: 'add',
            media: newMedia,
            addedBy: currentUser,
            timestamp: new Date().toISOString()
        });
        
        renderGallery();
        showToast('Media Added', `${title} added to gallery`, 'success');
        closeModal('catboxGalleryModal');
    }
    
    function deleteGalleryItem(id) {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can delete media', 'error');
            return;
        }
        
        const media = galleryItems.find(m => m.id === id);
        galleryItems = galleryItems.filter(item => item.id !== id);
        saveData('gallery', galleryItems);
        
        // Send realtime update
        sendRealtimeUpdate('gallery-updated', {
            action: 'delete',
            mediaId: id,
            mediaTitle: media?.title || 'Unknown',
            deletedBy: currentUser,
            timestamp: new Date().toISOString()
        });
        
        renderGallery();
        showToast('Media Deleted', 'Media removed from gallery', 'success');
    }
    
    function downloadMedia(url) {
        window.open(url, '_blank');
    }
    
    function shareMedia(url) {
        if (navigator.share) {
            navigator.share({
                title: 'Media from Kelas 8I',
                text: 'Check out this media from Kelas 8I!',
                url: url
            });
        } else {
            navigator.clipboard.writeText(url).then(() => {
                showToast('Link Copied', 'Media link copied to clipboard', 'success');
            });
        }
    }
    
    // ========== LIVE CHAT FUNCTIONS ==========
    let chatInterval = null;
    let onlineUsersInterval = null;
    
    function startChatConnection() {
        if (!userId) return;
        
        // Load chat history
        loadChatHistory();
        
        // Simulate real-time chat updates
        chatInterval = setInterval(() => {
            simulateNewMessage();
        }, 10000);
        
        // Update online users
        updateOnlineUsers();
        onlineUsersInterval = setInterval(updateOnlineUsers, 30000);
        
        // Join chat room
        addUserToOnlineList({
            id: userId,
            username: currentUser,
            fullName: JSON.parse(localStorage.getItem('portal8i_current_user')).fullName,
            role: userRole
        });
    }
    
    function stopChatConnection() {
        if (chatInterval) clearInterval(chatInterval);
        if (onlineUsersInterval) clearInterval(onlineUsersInterval);
        
        // Remove user from online list
        removeUserFromOnlineList(userId);
    }
    
    function loadChatHistory() {
        const data = loadData();
        chatMessages = data.chat || [];
        renderChatMessages();
    }
    
    function renderChatMessages() {
        const container = document.getElementById('chatMessages');
        container.innerHTML = '';
        
        chatMessages.forEach(msg => {
            const isOwn = msg.userId === userId;
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${isOwn ? 'own' : ''}`;
            
            messageDiv.innerHTML = `
                <div class="message-avatar" style="background: linear-gradient(135deg, ${getUserColor(msg.userId)}, ${getUserColor(msg.userId, true)});">
                    ${msg.username?.charAt(0) || 'U'}
                </div>
                <div class="message-content">
                    <div class="message-sender">
                        ${msg.fullName || msg.username}
                        <span style="font-size: 0.7rem; opacity: 0.6; margin-left: 5px;">
                            ${new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                        </span>
                    </div>
                    <div class="message-text">${msg.text}</div>
                </div>
            `;
            
            container.appendChild(messageDiv);
        });
        
        // Scroll to bottom
        container.scrollTop = container.scrollHeight;
        
        // Update message count
        document.getElementById('messageCount').textContent = `${chatMessages.length} messages`;
    }
    
    function sendChatMessage() {
        if (!userId) {
            showToast('Login Required', 'Please login to send messages', 'warning');
            return;
        }
        
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        
        if (!message) return;
        
        const userData = JSON.parse(localStorage.getItem('portal8i_current_user'));
        
        const newMessage = {
            id: Date.now(),
            userId: userId,
            username: currentUser,
            fullName: userData.fullName,
            text: message,
            timestamp: new Date().toISOString(),
            role: userRole
        };
        
        chatMessages.push(newMessage);
        saveData('chat', chatMessages);
        
        // Send realtime update
        if (isRealtimeConnected) {
            sendRealtimeUpdate('chat-message', newMessage);
        }
        
        // Render message
        renderChatMessages();
        
        // Clear input
        input.value = '';
        
        // Show in chat
        addMessageToChat(newMessage);
        
        // Simulate responses (for demo)
        setTimeout(() => {
            simulateResponse(newMessage);
        }, 1000);
    }
    
    function handleChatKeyPress(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            sendChatMessage();
        }
    }
    
    function addMessageToChat(message) {
        const container = document.getElementById('chatMessages');
        const isOwn = message.userId === userId;
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${isOwn ? 'own' : ''}`;
        messageDiv.innerHTML = `
            <div class="message-avatar" style="background: linear-gradient(135deg, ${getUserColor(message.userId)}, ${getUserColor(message.userId, true)});">
                ${message.username?.charAt(0) || 'U'}
            </div>
            <div class="message-content">
                <div class="message-sender">
                    ${message.fullName || message.username}
                    <span style="font-size: 0.7rem; opacity: 0.6; margin-left: 5px;">
                        ${new Date(message.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                    </span>
                </div>
                <div class="message-text">${message.text}</div>
            </div>
        `;
        
        container.appendChild(messageDiv);
        container.scrollTop = container.scrollHeight;
        
        // Update message count
        document.getElementById('messageCount').textContent = `${chatMessages.length} messages`;
    }
    
    function simulateNewMessage() {
        if (chatMessages.length === 0 || Math.random() > 0.3) return;
        
        const users = [
            { id: 1, name: "Yusuf Hisyama", role: "admin" },
            { id: 2, name: "Alkilla Afifa", role: "siswa" },
            { id: 3, name: "Bu Ani", role: "guru" },
            { id: 4, name: "Alan Khoirul", role: "siswa" }
        ];
        
        const user = users[Math.floor(Math.random() * users.length)];
        const messages = [
            "Hai semuanya! Ada yang sudah kerjakan tugas Matematika?",
            "Besok ada ujian IPA, jangan lupa belajar!",
            "Link grup WhatsApp baru udah diupdate ya",
            "Foto kegiatan kemarin udah diupload di galeri",
            "Ada yang bisa bantu soal nomor 5?",
            "Reminder: besok bawa buku paket IPS"
        ];
        
        const newMessage = {
            id: Date.now(),
            userId: user.id,
            username: user.name.toLowerCase().replace(' ', ''),
            fullName: user.name,
            text: messages[Math.floor(Math.random() * messages.length)],
            timestamp: new Date().toISOString(),
            role: user.role
        };
        
        chatMessages.push(newMessage);
        saveData('chat', chatMessages);
        
        // Send realtime update
        if (isRealtimeConnected && user.id !== userId) {
            sendRealtimeUpdate('chat-message', newMessage);
        }
        
        addMessageToChat(newMessage);
    }
    
    function simulateResponse(originalMessage) {
        if (Math.random() > 0.5 || !originalMessage.text.toLowerCase().includes('?')) return;
        
        const responses = [
            "Aku sudah kerjakan, nanti aku share jawabannya",
            "Bisa dibantu, nanti aku jelaskan di grup",
            "Wah aku juga belum kerjakan, kita diskusi yuk",
            "Coba lihat di buku halaman 45, ada contoh soalnya",
            "Aku masih bingung juga nih"
        ];
        
        const users = [
            { id: 2, name: "Alkilla Afifa", role: "siswa" },
            { id: 3, name: "Bu Ani", role: "guru" },
            { id: 5, name: "Nasywa Rohadatul", role: "siswa" }
        ];
        
        const user = users[Math.floor(Math.random() * users.length)];
        
        const responseMessage = {
            id: Date.now(),
            userId: user.id,
            username: user.name.toLowerCase().replace(' ', ''),
            fullName: user.name,
            text: responses[Math.floor(Math.random() * responses.length)],
            timestamp: new Date().toISOString(),
            role: user.role
        };
        
        setTimeout(() => {
            chatMessages.push(responseMessage);
            saveData('chat', chatMessages);
            
            // Send realtime update
            if (isRealtimeConnected && user.id !== userId) {
                sendRealtimeUpdate('chat-message', responseMessage);
            }
            
            addMessageToChat(responseMessage);
        }, 2000);
    }
    
    function addUserToOnlineList(user) {
        if (!user || !user.id) return;
        
        chatUsers.set(user.id, {
            ...user,
            lastSeen: new Date().toISOString(),
            isOnline: true
        });
        
        updateOnlineUsersDisplay();
    }
    
    function removeUserFromOnlineList(userId) {
        chatUsers.delete(userId);
        updateOnlineUsersDisplay();
    }
    
    function updateOnlineUsers() {
        // Update last seen for all users
        const now = new Date();
        chatUsers.forEach(user => {
            const lastSeen = new Date(user.lastSeen);
            const diffMinutes = (now - lastSeen) / (1000 * 60);
            
            if (diffMinutes > 5) {
                user.isOnline = false;
            }
        });
        
        updateOnlineUsersDisplay();
    }
    
    function updateOnlineUsersDisplay() {
        const container = document.getElementById('onlineUsersList');
        const onlineCount = Array.from(chatUsers.values()).filter(u => u.isOnline).length;
        
        // Update count
        document.getElementById('onlineCount').innerHTML = `
            <i class="fas fa-users"></i> <span id="onlineUsersCount">${onlineCount}</span> online
        `;
        
        // Update list
        container.innerHTML = '';
        
        Array.from(chatUsers.values())
            .filter(user => user.isOnline)
            .forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'flex items-center gap-3 p-3 mb-2 rounded-lg';
                userDiv.style.background = 'rgba(255,255,255,0.05)';
                
                userDiv.innerHTML = `
                    <div style="width:40px; height:40px; border-radius:50%; background:linear-gradient(135deg, ${getUserColor(user.id)}, ${getUserColor(user.id, true)}); display:flex; align-items:center; justify-content:center; color:white; font-weight:600;">
                        ${user.fullName?.charAt(0) || user.username?.charAt(0) || 'U'}
                    </div>
                    <div style="flex:1;">
                        <div style="font-weight:600;">${user.fullName || user.username}</div>
                        <div style="font-size:0.9rem; opacity:0.7; text-transform:capitalize;">${user.role?.replace('_', ' ') || 'user'}</div>
                    </div>
                    <div style="width:10px; height:10px; border-radius:50%; background:var(--success);"></div>
                `;
                
                container.appendChild(userDiv);
            });
        
        // Update analytics
        document.getElementById('analyticsOnline').textContent = onlineCount;
        document.getElementById('analyticsChats').textContent = chatMessages.length;
    }
    
    function getUserColor(userId, darken = false) {
        const colors = [
            '#6366f1', '#10b981', '#f59e0b', '#ef4444', 
            '#8b5cf6', '#06b6d4', '#f472b6', '#84cc16'
        ];
        const color = colors[userId % colors.length];
        
        if (darken) {
            return color.replace(')', ', 0.8)').replace('rgb', 'rgba');
        }
        return color;
    }
    
    function clearChat() {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can clear chat', 'error');
            return;
        }
        
        if (confirm('Are you sure you want to clear all chat messages?')) {
            chatMessages = [];
            saveData('chat', chatMessages);
            
            // Send realtime update
            sendRealtimeUpdate('system-update', {
                type: 'chat-cleared',
                clearedBy: currentUser,
                timestamp: new Date().toISOString(),
                message: 'Chat telah dikosongkan'
            });
            
            renderChatMessages();
            showToast('Chat Cleared', 'All chat messages have been deleted', 'success');
        }
    }
    
    function toggleEmojiPicker() {
        const picker = document.getElementById('emojiPicker');
        if (picker.style.display === 'none') {
            // Show emoji picker
            picker.style.display = 'block';
            renderEmojiPicker();
        } else {
            picker.style.display = 'none';
        }
    }
    
    function renderEmojiPicker() {
        const container = document.getElementById('emojiPicker');
        container.innerHTML = '';
        
        const emojis = ['ðŸ˜€', 'ðŸ˜‚', 'ðŸ¥°', 'ðŸ˜Ž', 'ðŸ¤”', 'ðŸ‘', 'ðŸ‘', 'ðŸŽ‰', 'ðŸ“š', 'âœï¸', 'ðŸŽµ', 'ðŸ“·', 'ðŸŽ¥', 'ðŸ’»', 'ðŸ“±'];
        
        emojis.forEach(emoji => {
            const btn = document.createElement('button');
            btn.className = 'btn btn-sm';
            btn.style.fontSize = '1.5rem';
            btn.style.padding = '5px';
            btn.style.background = 'transparent';
            btn.style.border = 'none';
            btn.innerHTML = emoji;
            btn.onclick = () => {
                const input = document.getElementById('chatInput');
                input.value += emoji;
                input.focus();
            };
            
            container.appendChild(btn);
        });
    }
    
    function attachFile() {
        // Create file input
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*,video/*,audio/*,.pdf,.doc,.docx';
        input.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                // For demo, just show a message
                showToast('File Selected', `${file.name} ready to send`, 'info');
                
                // In real implementation, you would upload the file
                // and send the link in chat
            }
        };
        input.click();
    }
    
    // ========== RANKING FUNCTIONS ==========
    function updateRankingList(topStudents) {
        const rankingList = document.getElementById('rankingList');
        rankingList.innerHTML = '';
        
        topStudents.forEach((student, index) => {
            const rank = index + 1;
            const rankItem = document.createElement('div');
            rankItem.className = 'flex items-center gap-4 p-3 mb-2 rounded-lg';
            rankItem.style.background = 'rgba(255,255,255,0.05)';
            
            rankItem.innerHTML = `
                <div style="width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:900; font-size:1.2rem; 
                    ${rank === 1 ? 'background: var(--gradient-gold); color: black;' : 
                      rank === 2 ? 'background: var(--gradient-primary); color: white;' :
                      rank === 3 ? 'background: var(--gradient-accent); color: white;' :
                      'background: rgba(255,255,255,0.1); color: white;'}">
                    ${rank}
                </div>
                <div style="flex:1;">
                    <div style="font-weight:600;">${student.name}</div>
                    <div style="font-size:0.9rem; opacity:0.7;">Nilai: ${student.averageGrade.toFixed(1)}</div>
                </div>
                <div style="font-weight:700; color:var(--primary);">
                    ${student.averageGrade.toFixed(1)}
                </div>
            `;
            rankingList.appendChild(rankItem);
        });
    }
    
    function initRankingChart(topStudents) {
        const ctx = document.getElementById('rankingChart').getContext('2d');
        const labels = topStudents.map(s => s.name.split(' ')[0]);
        const data = topStudents.map(s => s.averageGrade);
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Nilai Rata-rata',
                    data: data,
                    backgroundColor: [
                        'rgba(255, 215, 0, 0.8)',
                        'rgba(99, 102, 241, 0.8)',
                        'rgba(244, 114, 182, 0.8)',
                        'rgba(16, 185, 129, 0.8)',
                        'rgba(245, 158, 11, 0.8)',
                        'rgba(239, 68, 68, 0.8)',
                        'rgba(6, 182, 212, 0.8)',
                        'rgba(139, 92, 246, 0.8)',
                        'rgba(20, 184, 166, 0.8)',
                        'rgba(251, 191, 36, 0.8)'
                    ],
                    borderColor: [
                        'rgba(255, 215, 0, 1)',
                        'rgba(99, 102, 241, 1)',
                        'rgba(244, 114, 182, 1)',
                        'rgba(16, 185, 129, 1)',
                        'rgba(245, 158, 11, 1)',
                        'rgba(239, 68, 68, 1)',
                        'rgba(6, 182, 212, 1)',
                        'rgba(139, 92, 246, 1)',
                        'rgba(20, 184, 166, 1)',
                        'rgba(251, 191, 36, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `Nilai: ${context.raw}`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 10,
                        ticks: {
                            color: 'rgba(255,255,255,0.7)'
                        },
                        grid: {
                            color: 'rgba(255,255,255,0.1)'
                        }
                    },
                    x: {
                        ticks: {
                            color: 'rgba(255,255,255,0.7)',
                            maxRotation: 45
                        },
                        grid: {
                            color: 'rgba(255,255,255,0.1)'
                        }
                    }
                }
            }
        });
    }
    
    // ========== EVENT LISTENERS ==========
    function setupEventListeners() {
        // Theme toggle
        document.getElementById('themeToggle').addEventListener('click', () => {
            document.body.classList.toggle('light-mode');
            const icon = document.querySelector('#themeToggle i');
            if (document.body.classList.contains('light-mode')) {
                icon.className = 'fas fa-sun';
                localStorage.setItem('portal8i_theme', 'light');
            } else {
                icon.className = 'fas fa-moon';
                localStorage.setItem('portal8i_theme', 'dark');
            }
        });
        
        // Login button
        document.getElementById('loginBtn')?.addEventListener('click', () => {
            openModal('loginModal');
        });
        
        // Login form
        document.getElementById('loginForm')?.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            const fullName = document.getElementById('fullName').value;
            login(username, password, role, fullName);
        });
        
        // Catbox playlist form
        document.getElementById('catboxForm')?.addEventListener('submit', (e) => {
            e.preventDefault();
            const url = document.getElementById('catboxUrl').value;
            const title = document.getElementById('audioTitle').value;
            const artist = document.getElementById('audioArtist').value;
            const category = document.getElementById('audioCategory').value;
            
            if (url.includes('catbox.moe')) {
                addFromCatbox(url, title, artist, category);
            } else {
                showToast('Invalid URL', 'Please enter a valid Catbox URL', 'error');
            }
        });
        
        // Catbox gallery form
        document.getElementById('catboxGalleryForm')?.addEventListener('submit', (e) => {
            e.preventDefault();
            const url = document.getElementById('catboxGalleryUrl').value;
            const title = document.getElementById('catboxMediaTitle').value;
            const type = document.getElementById('catboxMediaType').value;
            const category = document.getElementById('catboxMediaCategory').value;
            const desc = document.getElementById('catboxMediaDesc').value;
            
            if (url.includes('catbox.moe')) {
                addMediaFromCatbox(url, title, type, category, desc);
            } else {
                showToast('Invalid URL', 'Please enter a valid Catbox URL', 'error');
            }
        });
        
        // Audio player events
        audioPlayer.addEventListener('timeupdate', () => {
            const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100 || 0;
            document.getElementById('progressBar').value = progress;
            
            const current = formatTime(audioPlayer.currentTime);
            const duration = formatTime(audioPlayer.duration);
            document.getElementById('currentTime').textContent = `${current} / ${duration}`;
        });
        
        audioPlayer.addEventListener('ended', () => {
            playNext();
        });
        
        document.getElementById('progressBar').addEventListener('input', (e) => {
            const time = (e.target.value / 100) * audioPlayer.duration;
            audioPlayer.currentTime = time;
        });
        
        document.getElementById('volumeControl').addEventListener('input', (e) => {
            audioPlayer.volume = e.target.value / 100;
        });
        
        // Gallery filter
        document.querySelectorAll('[data-gallery-filter]').forEach(filter => {
            filter.addEventListener('click', function() {
                const filterValue = this.dataset.galleryFilter;
                
                // Update active filter
                document.querySelectorAll('[data-gallery-filter]').forEach(f => f.classList.remove('active'));
                this.classList.add('active');
                
                // Filter gallery items
                document.querySelectorAll('.gallery-item').forEach(item => {
                    if (filterValue === 'all' || item.dataset.category === filterValue) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        });
        
        // Close modals on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });
        
        // Navbar scroll effect
        window.addEventListener('scroll', () => {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });
        
        // Smooth scrolling
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 100,
                        behavior: 'smooth'
                    });
                    
                    // Update active nav link
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.classList.remove('active');
                    });
                    this.classList.add('active');
                }
            });
        });
        
        // FAB action
        document.getElementById('fab').addEventListener('click', () => {
            if (!userId) {
                openModal('loginModal');
            } else if (isAdmin || userRole === 'guru') {
                openAdminPanel();
            } else {
                showToast('Quick Access', 'Scroll to explore features!', 'info');
            }
        });
        
        // Request notification permission
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }
    }
    
    function formatTime(seconds) {
        if (isNaN(seconds)) return '0:00';
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
    }
    
    // ========== INITIALIZATION ==========
    function init() {
        // Simulate loading
        simulateLoading();
        
        // Load saved theme
        const savedTheme = localStorage.getItem('portal8i_theme');
        if (savedTheme === 'light') {
            document.body.classList.add('light-mode');
            const icon = document.querySelector('#themeToggle i');
            if (icon) icon.className = 'fas fa-sun';
        }
        
        // Check login status
        checkLogin();
        
        // Initialize all modules
        renderStudents();
        initVoting();
        initPlaylist();
        initGallery();
        
        // Setup event listeners
        setupEventListeners();
        
        // Start countdown timer
        updateCountdown();
        setInterval(updateCountdown, 1000);
        
        // Initialize audio player
        audioPlayer.volume = 0.5;
        
        // Update analytics
        updateAnalytics();
        
        console.log('âœ¨ Portal Kelas 8I Elite loaded successfully!');
        console.log('ðŸš€ Features: Live Stream, Real-time Chat, Voting System, Playlist, Gallery, Admin Panel');
        console.log('ðŸ“¡ Realtime System: Ready to connect');
    }
    
    function updateAnalytics() {
        const data = loadData();
        document.getElementById('analyticsUsers').textContent = data.users.length || 34;
        document.getElementById('analyticsChats').textContent = chatMessages.length;
        document.getElementById('analyticsVotes').textContent = activeVote ? activeVote.totalVotes : 0;
        document.getElementById('analyticsOnline').textContent = chatUsers.size;
    }
    
    // Start the application
    document.addEventListener('DOMContentLoaded', init);
    
    // ========== ADMIN FUNCTIONS ==========
    function openAdminPanel() {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Akses Ditolak', 'Silakan login sebagai admin atau guru terlebih dahulu', 'error');
            openModal('loginModal');
            return;
        }
        
        updateAnalytics();
        openModal('adminPanelModal');
    }
    
    function exportData() {
        const data = loadData();
        const dataStr = JSON.stringify(data, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        const exportFileDefaultName = `backup-kelas8i-${new Date().toISOString().split('T')[0]}.json`;
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
        
        showToast('Export Berhasil', 'Data telah diexport ke JSON', 'success');
    }
    
    function backupData() {
        showToast('Backup Started', 'Data sedang di-backup ke cloud...', 'info');
        setTimeout(() => {
            showToast('Backup Complete', 'Data telah di-backup ke cloud', 'success');
        }, 2000);
    }
    
    function manageUsers() {
        showToast('User Management', 'Opening user management panel...', 'info');
        // Implement user management UI
    }
    
    function exportAllData() {
        showToast('Export All', 'Exporting all data...', 'info');
        exportData();
    }
    
    function systemLogs() {
        showToast('System Logs', 'Opening system logs...', 'info');
    }
    
    function resetSystem() {
        if (!isAdmin) {
            showToast('Access Denied', 'Only admin can reset system', 'error');
            return;
        }
        
        if (confirm('Yakin ingin mereset sistem? Semua data akan dikembalikan ke default.')) {
            localStorage.clear();
            location.reload();
        }
    }
    
    // ========== PLACEHOLDER FUNCTIONS ==========
    function addStudent() {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can add students', 'error');
            return;
        }
        addStudentWithRealtimeDialog();
    }
    
    function importStudents() {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can import data', 'error');
            return;
        }
        showToast('Coming Soon', 'Fitur import Excel dalam pengembangan', 'info');
    }
    
    function generateRanking() {
        showToast('Ranking Generated', 'Ranking telah diperbarui', 'success');
        renderStudents();
    }
    
    function clearAllGrades() {
        clearAllGradesWithRealtime();
    }
    
    function showCharts() {
        showToast('Charts', 'Grafik akan ditampilkan di halaman ranking', 'info');
    }
    
    function printTable() {
        window.print();
    }
    
    function exportToExcel() {
        const data = loadData();
        let csvContent = "data:text/csv;charset=utf-8,";
        
        // Header
        csvContent += "No,Nama,NIS,Gender,Nilai,Kehadiran,Status\n";
        
        // Data
        data.students.forEach((student, index) => {
            csvContent += `${index + 1},${student.name},${student.nis},${student.gender},${student.averageGrade},${student.attendance},${student.status}\n`;
        });
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', encodeURI(csvContent));
        linkElement.setAttribute('download', 'data-siswa-kelas8i.csv');
        linkElement.click();
        
        showToast('Export Excel Berhasil', 'Data telah diexport ke CSV', 'success');
    }
    
    function editStudent(id) {
        const student = studentsData.find(s => s.id === id);
        if (student) {
            const newGrade = prompt(`Edit nilai ${student.name}:`, student.averageGrade);
            if (newGrade !== null) {
                const updatedData = {
                    averageGrade: parseFloat(newGrade) || student.averageGrade,
                    attendance: student.attendance
                };
                updateStudentWithRealtime(id, updatedData);
            }
        }
    }
    
    function viewStudent(id) {
        const student = studentsData.find(s => s.id === id);
        if (student) {
            alert(`Detail Siswa:\n\nNama: ${student.name}\nNIS: ${student.nis}\nNilai: ${student.averageGrade}\nKehadiran: ${student.attendance}%\nPrestasi: ${student.achievements.join(', ') || '-'}`);
        }
    }
    
    function deleteStudent(id) {
        deleteStudentWithRealtime(id);
    }
    
    function searchStudents() {
        const searchTerm = document.getElementById('searchStudent').value.toLowerCase();
        const data = loadData();
        const filtered = data.students.filter(student => 
            student.name.toLowerCase().includes(searchTerm) || 
            student.nis.includes(searchTerm)
        );
        
        const tableBody = document.getElementById('studentsTableBody');
        tableBody.innerHTML = '';
        
        filtered.forEach((student, index) => {
            const rank = index + 1;
            const rankClass = rank <= 3 ? 'badge-gold' : rank <= 10 ? 'badge-primary' : 'badge-success';
            const rankText = rank <= 3 ? `<i class="fas fa-crown"></i> ${rank}` : rank;
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>
                    <span class="badge ${rankClass}">${rankText}</span>
                </td>
                <td>
                    <div style="display:flex; align-items:center; gap:12px;">
                        <div style="width:45px; height:45px; border-radius:50%; background:var(--gradient-primary); display:flex; align-items:center; justify-content:center; color:white; font-weight:700; font-size:1.2rem;">
                            ${student.name.charAt(0)}
                        </div>
                        <div>
                            <div style="font-weight:700;">${student.name}</div>
                            <div style="font-size:12px; opacity:0.7; display:flex; gap:5px;">
                                <span>${student.gender}</span>
                                <span>â€¢</span>
                                <span>${student.nis}</span>
                            </div>
                        </div>
                    </div>
                </td>
                <td>
                    <span class="badge badge-primary">${student.nis}</span>
                </td>
                <td>
                    <div style="display:flex; align-items:center; gap:12px;">
                        <div style="flex:1; height:10px; background:rgba(255,255,255,0.1); border-radius:var(--radius-full); overflow:hidden;">
                            <div style="width:${(student.averageGrade / 10) * 100}%; height:100%; background:var(--gradient-primary);"></div>
                        </div>
                        <span style="font-weight:700; font-size:1.1rem; color:var(--primary);">${student.averageGrade.toFixed(1)}</span>
                    </div>
                </td>
                <td>
                    <div style="display:flex; align-items:center; gap:8px;">
                        <span class="badge ${student.attendance >= 95 ? 'badge-success' : student.attendance >= 85 ? 'badge-warning' : 'badge-danger'}">
                            ${student.attendance}%
                        </span>
                        <div style="width:50px; height:6px; background:rgba(255,255,255,0.1); border-radius:3px; overflow:hidden;">
                            <div style="width:${student.attendance}%; height:100%; background:${student.attendance >= 95 ? 'var(--success)' : student.attendance >= 85 ? 'var(--warning)' : 'var(--danger)'};"></div>
                        </div>
                    </div>
                </td>
                <td>
                    <span class="badge ${student.status === 'Aktif' ? 'badge-success' : 'badge-danger'}">
                        ${student.status}
                    </span>
                </td>
                <td>
                    <div style="display:flex; gap:4px; flex-wrap:wrap;">
                        ${student.achievements && student.achievements.length > 0 
                            ? student.achievements.map(ach => `<span class="badge badge-neon" style="font-size:10px; padding:2px 6px;">${ach}</span>`).join('')
                            : '<span style="opacity:0.6; font-size:12px;">-</span>'}
                    </div>
                </td>
                <td class="admin-only">
                    <div style="display:flex; gap:5px;">
                        <button class="btn btn-sm btn-outline" onclick="editStudent(${student.id})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline" onclick="viewStudent(${student.id})" title="Detail">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline" onclick="deleteStudentWithRealtime(${student.id})" title="Hapus">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }
    
    // Voting admin functions
    function createNewVote() {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can create votes', 'error');
            return;
        }
        showToast('Coming Soon', 'Fitur buat voting baru dalam pengembangan', 'info');
    }
    
    function resetVoting() {
        resetVotingWithRealtime();
    }
    
    function deleteVoting() {
        deleteVotingWithRealtime();
    }
    
    // Playlist admin functions
    function openAddPlaylistModal() {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can add to playlist', 'error');
            return;
        }
        showToast('Coming Soon', 'Fitur tambah audio dalam pengembangan', 'info');
    }
    
    function clearPlaylist() {
        clearPlaylistWithRealtime();
    }
    
    function shufflePlaylist() {
        // Fisher-Yates shuffle
        for (let i = playlist.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [playlist[i], playlist[j]] = [playlist[j], playlist[i]];
        }
        
        saveData('playlist', playlist);
        renderPlaylist();
        showToast('Playlist Shuffled', 'Tracks have been shuffled', 'success');
    }
    
    // Gallery admin functions
    function openGalleryModal() {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can add media', 'error');
            return;
        }
        showToast('Coming Soon', 'Fitur tambah foto dalam pengembangan', 'info');
    }
    
    function openVideoModal() {
        if (!isAdmin && userRole !== 'guru') {
            showToast('Access Denied', 'Only admins and teachers can add media', 'error');
            return;
        }
        showToast('Coming Soon', 'Fitur tambah video dalam pengembangan', 'info');
    }
    
    function deleteAllGallery() {
        deleteAllGalleryWithRealtime();
    }
    
    function loadMoreGallery() {
        showToast('Loading...', 'Memuat lebih banyak media', 'info');
        // Implement lazy loading
    }
    
    function systemSettings() {
        showToast('System Settings', 'Opening system settings...', 'info');
    }
    
    function togglePassword() {
        const passwordInput = document.getElementById('password');
        const icon = passwordInput.nextElementSibling.querySelector('i');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            icon.className = 'fas fa-eye-slash';
        } else {
            passwordInput.type = 'password';
            icon.className = 'fas fa-eye';
        }
    }
    </script>
    <!-- ðŸ”¥ FIREBASE INTEGRATION - TAMBAHKAN INI -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js"></script>

<script>
// ðŸ”¥ FIREBASE CONFIG - PUNYA LU
const firebaseConfig = {
    apiKey: "AIzaSyD4tW1lxChZH8CqvEj9FjQoF3b76g9WsRY",
    authDomain: "kelas8i-realtime.firebaseapp.com",
    databaseURL: "https://kelas8i-realtime-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "kelas8i-realtime",
    storageBucket: "kelas8i-realtime.firebasestorage.app",
    messagingSenderId: "117713528911",
    appId: "1:117713528911:web:f31f5675f8f2289ff2623a"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

console.log("ðŸ”¥ðŸ”¥ðŸ”¥ YAMA X BERHASIL! ðŸ”¥ðŸ”¥ðŸ”¥");
</script>
</body>
</html>